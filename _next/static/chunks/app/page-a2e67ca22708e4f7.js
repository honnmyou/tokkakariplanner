(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3022:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>el});var r=a(5155),s=a(2115),o=a(2525),l=a(4616),n=a(9708),i=a(2085),c=a(3999);let d=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),u=s.forwardRef((e,t)=>{let{className:a,variant:s,size:o,asChild:l=!1,...i}=e,u=l?n.DX:"button";return(0,r.jsx)(u,{className:(0,c.cn)(d({variant:s,size:o,className:a})),ref:t,...i})});u.displayName="Button";let m=s.forwardRef((e,t)=>{let{className:a,type:s,...o}=e;return(0,r.jsx)("input",{type:s,className:(0,c.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...o})});m.displayName="Input";var x=a(4416),g=a(9074),h=a(4186);function p(e){let t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate());return Math.ceil((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-a.getTime())/864e5)}function f(){let e=new Date,t=7-e.getDay(),a=new Date(e.getTime()+24*t*36e5);return a.setHours(23,59,0,0),a}function b(){let e=new Date;return e.setHours(23,59,0,0),e}function v(){let e=new Date;return e.setDate(e.getDate()+1),e.setHours(23,59,0,0),e}function k(e){let{isOpen:t,onClose:a,onSubmit:o,category:l,tutorialStep:n,onTutorialStepComplete:i}=e,[c,d]=(0,s.useState)(""),[p,k]=(0,s.useState)(),[y,w]=(0,s.useState)(null),[j,N]=(0,s.useState)(!1),[S,D]=(0,s.useState)(""),[C,A]=(0,s.useState)("23:59");(0,s.useEffect)(()=>{"task-form-explanation"===n&&t&&d("プレゼン資料を作成する")},[n,t]);let T=()=>!n||"task-form-explanation"!==n||c.trim().includes("プレゼン資料");if(!t)return null;let E=e=>{e.preventDefault(),c.trim()&&(o(c.trim(),p,l),d(""),k(void 0),w(null),N(!1),D(""),A("23:59"),a())},I=e=>{switch(w(e),e){case"today":k(b());break;case"tomorrow":k(v());break;case"weekend":k(f());break;case"custom":N(!0);return;case"none":k(void 0)}N(!1)},F="immediate"===l?"text-red-500":"text-blue-500",R="immediate"===l?"bg-red-500 hover:bg-red-600":"bg-blue-500 hover:bg-blue-600",O="immediate"===l?"bg-red-100 border-red-500 text-red-700":"bg-blue-100 border-blue-500 text-blue-700";return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"task-form bg-white w-full max-w-md rounded-2xl shadow-2xl transform transition-all duration-300 ease-out scale-100 opacity-100 flex flex-col h-auto max-h-[85vh] ".concat(n&&!(!n||"task-form-explanation"===n)?"pointer-events-none opacity-50":""),children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-6 pb-4 border-b border-gray-100 flex-shrink-0",children:[(0,r.jsx)("h2",{className:"text-lg font-bold ".concat(F),children:"新しいタスク"}),(0,r.jsx)(u,{variant:"ghost",size:"icon",onClick:a,className:"hover:bg-gray-100",children:(0,r.jsx)(x.A,{className:"w-5 h-5"})})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 pt-4 min-h-0",children:["task-form-explanation"===n&&(0,r.jsxs)("div",{className:"border rounded-lg p-4 mb-4 animate-in slide-in-from-top-2 duration-300",style:{backgroundColor:"#E3F2FD",borderColor:"#0288D1"},children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("div",{className:"w-5 h-5 text-white rounded-full flex items-center justify-center text-xs font-bold",style:{backgroundColor:"#0288D1"},children:"?"}),(0,r.jsx)("h3",{className:"text-sm font-bold",style:{color:"#263238"},children:"タスクを入力しよう"})]}),(0,r.jsx)("p",{className:"text-sm mb-2 font-bold",style:{color:"#263238"},children:"「プレゼン資料を作成する」と入力して、「タスクを追加」ボタンをクリックしてください。"}),(0,r.jsx)("div",{className:"bg-white border rounded p-2",style:{borderColor:"#0288D1"},children:(0,r.jsx)("p",{className:"text-xs font-bold",style:{color:"#0288D1"},children:"\uD83D\uDCA1 期限設定は任意です。まずはタスクの追加を体験してみましょう！"})})]}),(0,r.jsxs)("form",{onSubmit:E,className:"space-y-6",children:[(0,r.jsx)("div",{children:(0,r.jsx)(m,{placeholder:"タスクを入力...",value:c,onChange:e=>d(e.target.value),className:"text-base font-bold",autoFocus:!0})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-bold mb-3 text-gray-700",children:"期限設定"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,r.jsx)(u,{type:"button",variant:"outline",onClick:()=>I("today"),className:"justify-start transition-all duration-200 font-bold ".concat("today"===y?"".concat(O," shadow-md"):"hover:bg-gray-50"),children:"今日"}),(0,r.jsx)(u,{type:"button",variant:"outline",onClick:()=>I("tomorrow"),className:"justify-start transition-all duration-200 font-bold ".concat("tomorrow"===y?"".concat(O," shadow-md"):"hover:bg-gray-50"),children:"明日"}),(0,r.jsx)(u,{type:"button",variant:"outline",onClick:()=>I("weekend"),className:"justify-start transition-all duration-200 font-bold ".concat("weekend"===y?"".concat(O," shadow-md"):"hover:bg-gray-50"),children:"今週末"}),(0,r.jsxs)(u,{type:"button",variant:"outline",onClick:()=>I("custom"),className:"justify-start transition-all duration-200 font-bold ".concat("custom"===y?"".concat(O," shadow-md"):"hover:bg-gray-50"),children:[(0,r.jsx)(g.A,{className:"w-4 h-4 mr-2"}),"日付指定"]}),(0,r.jsx)(u,{type:"button",variant:"outline",onClick:()=>I("none"),className:"justify-start col-span-2 transition-all duration-200 font-bold ".concat("none"===y?"".concat(O," shadow-md"):"hover:bg-gray-50"),children:"期限なし"})]})]}),j&&(0,r.jsxs)("div",{className:"space-y-3 p-4 bg-gray-50 rounded-lg border border-gray-200 animate-in slide-in-from-top-2 duration-300",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("h4",{className:"text-sm font-bold text-gray-700",children:"カスタム日時設定"}),(0,r.jsx)(u,{type:"button",variant:"ghost",size:"sm",onClick:()=>{N(!1),w(null)},className:"h-6 w-6 p-0 hover:bg-gray-200",children:(0,r.jsx)(x.A,{className:"w-3 h-3"})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-bold text-gray-700",children:"日付"}),(0,r.jsx)(m,{type:"date",value:S,onChange:e=>D(e.target.value),className:"mt-1"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-bold text-gray-700",children:"時刻"}),(0,r.jsx)(m,{type:"time",value:C,onChange:e=>A(e.target.value),className:"mt-1"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(u,{type:"button",onClick:()=>{if(S){let[e,t]=C.split(":"),a=new Date(S);a.setHours(Number.parseInt(e),Number.parseInt(t),0,0),k(a),N(!1)}},className:"flex-1 ".concat(R," transition-all duration-200 font-bold"),size:"sm",disabled:!S,children:"設定"}),(0,r.jsx)(u,{type:"button",variant:"outline",onClick:()=>{N(!1),w(null)},size:"sm",className:"px-3 font-bold",children:"キャンセル"})]})]}),p&&(0,r.jsx)("div",{className:"p-3 rounded-lg border transition-all duration-300 animate-in slide-in-from-top-2 ".concat("immediate"===l?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"),children:(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm ".concat("immediate"===l?"text-red-700":"text-blue-700"),children:[(0,r.jsx)(h.A,{className:"w-4 h-4"}),(0,r.jsxs)("span",{className:"font-bold",children:["期限: ",p.toLocaleString("ja-JP")]})]})})]})]}),(0,r.jsx)("div",{className:"p-6 pt-4 border-t border-gray-100 flex-shrink-0",children:(0,r.jsx)(u,{type:"submit",className:"task-form-submit w-full ".concat(R," transition-all duration-200 hover:scale-105 font-bold ").concat(c.trim()&&(!n||T())?"":"opacity-50 cursor-not-allowed"),disabled:!c.trim()||"task-form-explanation"===n&&!T(),onClick:E,children:"タスクを追加"})})]})})}var y=a(5690),w=a(5196),j=a(1243),N=a(3987);function S(e){try{let t=localStorage.getItem("task-progress-".concat(e));if(t){let a=JSON.parse(t);return console.log("\uD83D\uDCCA Loaded progress for task ".concat(e,":"),a),a}}catch(e){console.error("Failed to load progress:",e)}return null}function D(e,t){try{localStorage.setItem("task-progress-".concat(e),JSON.stringify(t)),console.log("\uD83D\uDCBE Saved progress for task ".concat(e,":"),t)}catch(r){if(console.error("Failed to save progress:",r),r instanceof Error&&"QuotaExceededError"===r.name){console.log("\uD83D\uDEA8 Storage quota exceeded while saving progress, performing cleanup...");let{emergencyCleanup:r}=a(3987);r();try{localStorage.setItem("task-progress-".concat(e),JSON.stringify(t)),console.log("✅ Successfully saved progress after cleanup")}catch(e){console.error("❌ Failed to save progress even after cleanup:",e)}}}}let C={DARK_GRAY:"#444444",BLUE:"#007AFF",RED:"#FF5F68",TEAL:"#287566",WHITE:"#FFFFFF"};function A(e){let{task:t,onToggleComplete:a,onEdit:o,onDelete:l,onBreakdown:n,onExecute:i,accentColor:c,tutorialStep:d,showTutorial:u}=e,[k,N]=(0,s.useState)(!1),[D,A]=(0,s.useState)(t.title),[T,E]=(0,s.useState)(t.dueDate?t.dueDate.toISOString().slice(0,16):""),I=(0,s.useRef)(null),F=(0,s.useRef)(null),[R,O]=(0,s.useState)(null),[M,P]=(0,s.useState)(!1),[z,_]=(0,s.useState)(""),[B,H]=(0,s.useState)("23:59"),K=null!==S(t.id),L=function(e){let t=S(e);if(!t)return!1;let a=t.completed.filter(Boolean).length;return a>0&&a<t.generatedTasks.length}(t.id),Y=function(e){let t=S(e);return t&&t.generatedTasks.length?Math.round(t.completed.filter(Boolean).length/t.generatedTasks.length*100):0}(t.id),W=t.dueDate?function(e){let t=p(e);if(t<0)return{level:"overdue",className:"text-white border-transparent",bgClassName:"bg-red-600",showAlert:!0,shouldBlink:!0};if(0===t)return{level:"today",className:"text-white border-transparent",bgClassName:"bg-red-600",showAlert:!0,shouldBlink:!0};if(1===t)return{level:"tomorrow",className:"text-white border-transparent",bgClassName:"bg-orange-500",showAlert:!0,shouldBlink:!1};if(t<=3)return{level:"soon",className:"text-gray-800 border-yellow-300",bgClassName:"bg-yellow-200",showAlert:!1,shouldBlink:!1};if(t<=7)return{level:"normal",className:"text-gray-700 border-gray-300",bgClassName:"bg-gray-200",showAlert:!1,shouldBlink:!1};else return{level:"distant",className:"text-gray-600 border-gray-300",bgClassName:"bg-gray-100",showAlert:!1,shouldBlink:!1}}(t.dueDate):null,U=e=>{if(!u)return!0;switch(d){case"simple-task-completion":return"task-check"===e&&"tutorial-sample-task"===t.id;case"task-breakdown":return"task-breakdown"===e&&t.title.includes("プレゼン資料");default:return!1}};(0,s.useEffect)(()=>{k&&I.current&&(I.current.focus(),I.current.select())},[k]),(0,s.useEffect)(()=>{let e=e=>{F.current&&!F.current.contains(e.target)&&k&&J()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[k]);let G=()=>{var e;if(D.trim()&&D!==t.title||T!==((null==(e=t.dueDate)?void 0:e.toISOString().slice(0,16))||"")){let e=T?new Date(T):void 0;o(t.id,D.trim(),e)}N(!1),P(!1),O(null)},J=()=>{A(t.title),E(t.dueDate?t.dueDate.toISOString().slice(0,16):""),N(!1),P(!1),O(null)},X=e=>{switch(O(e),e){case"today":E(b().toISOString().slice(0,16));break;case"tomorrow":E(v().toISOString().slice(0,16));break;case"weekend":E(f().toISOString().slice(0,16));break;case"custom":P(!0);return;case"none":E("")}P(!1)},q=c.includes("red")?"bg-red-100 border-red-500 text-red-700":"bg-blue-100 border-blue-500 text-blue-700";return(0,r.jsx)("div",{ref:F,className:"task-item bg-white rounded-lg border transition-all duration-300 ".concat(t.completed?"opacity-60":""," ").concat(L?"border-teal-300":"border-gray-200"," p-2.5 hover:shadow-md"),children:k?(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)(m,{ref:I,value:D,onChange:e=>A(e.target.value),onKeyDown:e=>{"Enter"===e.key?G():"Escape"===e.key&&J()},className:"text-base font-bold",placeholder:"タスクを入力..."}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-bold mb-2 text-gray-700",children:"期限設定"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,r.jsx)("button",{type:"button",onClick:()=>X("today"),className:"px-2 py-1.5 text-sm border rounded text-left transition-all duration-200 font-bold ".concat("today"===R?"".concat(q," shadow-md"):"border-gray-300 hover:bg-gray-50"),children:"今日"}),(0,r.jsx)("button",{type:"button",onClick:()=>X("tomorrow"),className:"px-2 py-1.5 text-sm border rounded text-left transition-all duration-200 font-bold ".concat("tomorrow"===R?"".concat(q," shadow-md"):"border-gray-300 hover:bg-gray-50"),children:"明日"}),(0,r.jsx)("button",{type:"button",onClick:()=>X("weekend"),className:"px-2 py-1.5 text-sm border rounded text-left transition-all duration-200 font-bold ".concat("weekend"===R?"".concat(q," shadow-md"):"border-gray-300 hover:bg-gray-50"),children:"今週末"}),(0,r.jsxs)("button",{type:"button",onClick:()=>X("custom"),className:"px-2 py-1.5 text-sm border rounded text-left flex items-center gap-1 transition-all duration-200 font-bold ".concat("custom"===R?"".concat(q," shadow-md"):"border-gray-300 hover:bg-gray-50"),children:[(0,r.jsx)(g.A,{className:"w-3 h-3"}),"日付指定"]}),(0,r.jsx)("button",{type:"button",onClick:()=>X("none"),className:"px-2 py-1.5 text-sm border rounded text-left col-span-2 transition-all duration-200 font-bold ".concat("none"===R?"".concat(q," shadow-md"):"border-gray-300 hover:bg-gray-50"),children:"期限なし"})]})]}),M&&(0,r.jsxs)("div",{className:"space-y-2 p-2 bg-gray-50 rounded-lg border border-gray-200 animate-in slide-in-from-top-2 duration-300",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs font-bold text-gray-700",children:"日付"}),(0,r.jsx)(m,{type:"date",value:z,onChange:e=>_(e.target.value),className:"mt-1 text-sm"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs font-bold text-gray-700",children:"時刻"}),(0,r.jsx)(m,{type:"time",value:B,onChange:e=>H(e.target.value),className:"mt-1 text-sm"})]}),(0,r.jsx)("button",{type:"button",onClick:()=>{if(z){let[e,t]=B.split(":"),a=new Date(z);a.setHours(Number.parseInt(e),Number.parseInt(t),0,0),E(a.toISOString().slice(0,16)),P(!1)}},className:"px-2 py-1 text-sm text-white rounded transition-all duration-200 font-bold",style:{backgroundColor:c.includes("red")?C.RED:C.BLUE},children:"設定"})]}),T&&(0,r.jsx)("div",{className:"bg-gray-50 p-2 rounded text-sm animate-in slide-in-from-top-2 duration-300",children:(0,r.jsxs)("div",{className:"flex items-center gap-1 text-gray-600",children:[(0,r.jsx)(h.A,{className:"w-3 h-3"}),(0,r.jsxs)("span",{className:"font-bold",children:["期限: ",new Date(T).toLocaleString("ja-JP")]})]})}),(0,r.jsxs)("div",{className:"flex gap-2 pt-1",children:[(0,r.jsxs)("button",{onClick:G,disabled:!D.trim(),className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 text-white rounded-lg transition-all duration-200 hover:scale-105 shadow-sm hover:shadow-md font-bold text-sm ".concat(D.trim()?"":"opacity-50 cursor-not-allowed"),style:{backgroundColor:c.includes("red")?C.RED:C.BLUE},children:[(0,r.jsx)(w.A,{className:"w-4 h-4"}),"保存"]}),(0,r.jsxs)("button",{onClick:J,className:"flex items-center justify-center gap-1.5 px-3 py-2 border-2 border-gray-300 text-gray-700 rounded-lg transition-all duration-200 hover:scale-105 shadow-sm hover:shadow-md font-bold text-sm bg-white hover:bg-gray-50",children:[(0,r.jsx)(x.A,{className:"w-4 h-4"}),"キャンセル"]})]})]}):(0,r.jsxs)("div",{className:"flex items-start gap-2.5",children:[(0,r.jsx)("button",{onClick:()=>a(t.id),disabled:u&&!U("task-check"),className:"task-check-button flex items-center justify-center transition-all duration-200 flex-shrink-0 self-center ml-1 mr-1 ".concat(t.completed?"border-transparent":"border-gray-300 hover:border-gray-400 hover:scale-110"," ").concat(u&&!U("task-check")?"opacity-50 cursor-not-allowed":""),style:{width:"20px",height:"20px",minWidth:"20px",minHeight:"20px",borderWidth:"2px",borderRadius:"50%",borderColor:t.completed?"transparent":"#d1d5db",backgroundColor:t.completed?c.includes("red")?C.RED:C.BLUE:C.WHITE},children:t.completed&&(0,r.jsx)("svg",{className:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0 space-y-1",children:[t.dueDate&&W&&(0,r.jsx)("div",{className:"flex justify-start",children:(0,r.jsxs)("div",{className:"inline-flex items-center gap-1 text-xs px-1.5 py-0.5 rounded-full border font-bold transition-all duration-300 due-date-text ".concat(W.className," ").concat(W.shouldBlink?"animate-pulse":""),style:{backgroundColor:"overdue"===W.level||"today"===W.level?"#dc2626":"tomorrow"===W.level?"#f97316":"soon"===W.level?"#fef08a":"normal"===W.level?"#e5e7eb":"#f3f4f6"},children:[W.showAlert&&(0,r.jsx)(j.A,{className:"w-2.5 h-2.5"}),(0,r.jsx)(h.A,{className:"w-2.5 h-2.5"}),(0,r.jsx)("span",{className:"font-bold text-xs",children:function(e){let t=p(e);if(t<0){let e=Math.abs(t);return"".concat(e,"日遅れ")}return 0===t?"今日まで":1===t?"明日まで":"後".concat(t,"日")}(t.dueDate)}),23!==t.dueDate.getHours()||59!==t.dueDate.getMinutes()?(0,r.jsx)("span",{className:"font-bold text-xs",children:t.dueDate.toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})}):null]})}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{onClick:e=>{!e.target.closest(".drag-handle")&&(u||N(!0))},className:"flex-1 cursor-pointer hover:bg-gray-50 rounded-lg p-1.5 -m-1.5 transition-colors duration-200 min-w-0 ".concat(u?"cursor-not-allowed":""),children:(0,r.jsx)("div",{className:"text-sm font-bold text-left transition-colors duration-200 task-title leading-snug ".concat(t.completed?"line-through":""),style:{color:C.DARK_GRAY},children:t.title})}),(0,r.jsx)("div",{className:"flex-shrink-0",children:K?(0,r.jsxs)("button",{onClick:()=>null==i?void 0:i(t.id),className:"flex items-center gap-1 px-2 py-1 text-white rounded-md transition-all duration-200 hover:scale-105 shadow-sm hover:shadow-md font-bold text-xs",style:{backgroundColor:C.TEAL},title:"続きから実行",children:[(0,r.jsx)(y.A,{className:"w-3 h-3 fill-current"}),(0,r.jsx)("span",{children:"実行"})]}):(0,r.jsxs)("button",{onClick:()=>null==n?void 0:n(t.id),disabled:u&&!U("task-breakdown"),className:"task-breakdown-button flex items-center gap-1 px-2 py-1 border-2 rounded-md transition-all duration-200 hover:scale-105 shadow-sm hover:shadow-md font-bold text-xs ".concat(u&&!U("task-breakdown")?"opacity-50 cursor-not-allowed":""),style:{borderColor:c.includes("red")?C.RED:C.BLUE,color:c.includes("red")?C.RED:C.BLUE,backgroundColor:C.WHITE},title:"分解してから実行",children:[(0,r.jsx)("img",{src:c.includes("red")?"/images/breakdown-icon-red.png":"/images/breakdown-icon-blue.png",alt:"分解",className:"w-3 h-3"}),(0,r.jsx)("span",{children:"分解"})]})})]}),L&&(0,r.jsxs)("div",{className:"flex items-center gap-1.5 mt-1",children:[(0,r.jsx)("div",{className:"flex-1 bg-gray-200 rounded-full h-1.5",children:(0,r.jsx)("div",{className:"h-1.5 rounded-full transition-all duration-300",style:{width:"".concat(Y,"%"),backgroundColor:C.TEAL}})}),(0,r.jsxs)("span",{className:"text-xs font-bold progress-percentage min-w-[2rem] text-right",style:{color:C.TEAL},children:[Y,"%"]})]})]})]})})}var T=a(4021);function E(e){let{isVisible:t,taskTitle:a,onUndo:o,onClose:l}=e,[n,i]=(0,s.useState)(5);return((0,s.useEffect)(()=>{if(t){i(5);let e=setInterval(()=>{i(e=>e<=1?(l(),0):e-1)},1e3);return()=>clearInterval(e)}},[t,l]),t)?(0,r.jsxs)("div",{className:"undo-toast fixed bottom-20 left-4 right-4 bg-gray-800 text-white p-4 rounded-lg shadow-lg z-40 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("p",{className:"text-sm",children:["「",a,"」をゴミ箱へ移動しました"]}),(0,r.jsxs)("p",{className:"text-xs text-gray-300",children:[n,"秒後にゴミ箱へ移動"]})]}),(0,r.jsxs)(u,{onClick:o,variant:"ghost",size:"sm",className:"text-white hover:bg-gray-700 ml-2",children:[(0,r.jsx)(T.A,{className:"w-4 h-4 mr-1"}),"取り消し"]})]}):null}function I(e){let{isOpen:t,onClose:a}=e,[l,n]=(0,s.useState)([]),[i,c]=(0,s.useState)(!1),[d,m]=(0,s.useState)(null);(0,s.useEffect)(()=>{t&&n((0,N.getTrashItems)())},[t]);let h=e=>{let t=new Date().getTime()-e.getTime(),a=Math.floor(t/864e5),r=Math.floor(t/36e5),s=Math.floor(t/6e4);return a>0?"".concat(a,"日前"):r>0?"".concat(r,"時間前"):s>0?"".concat(s,"分前"):"たった今"},p=e=>"immediate"===e?"#FF5F68":"#007AFF",f=e=>{m(e)};return t?(0,r.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:[(0,r.jsxs)("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-2xl transform transition-all duration-300 ease-out scale-100 opacity-100 flex flex-col",style:{maxHeight:"85vh"},children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-6 pb-4 border-b border-gray-100 flex-shrink-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(o.A,{className:"w-6 h-6 text-gray-600"}),(0,r.jsx)("h2",{className:"text-lg font-bold text-gray-800",children:"ゴミ箱"})]}),(0,r.jsx)(u,{variant:"ghost",size:"icon",onClick:a,className:"hover:bg-gray-100",children:(0,r.jsx)(x.A,{className:"w-5 h-5"})})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto p-6 pt-4 min-h-0",children:0===l.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)(o.A,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500 font-bold",children:"ゴミ箱は空です"}),(0,r.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"削除されたタスクがここに表示されます"})]}):(0,r.jsx)("div",{className:"space-y-3",children:l.map(e=>(0,r.jsx)("div",{className:"p-4 rounded-lg border bg-gray-50 border-gray-200 transition-all duration-200",children:(0,r.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,r.jsxs)("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"w-4 h-4 rounded-full flex-shrink-0 mt-1",style:{backgroundColor:p(e.category)},title:"immediate"===e.category?"まず最初にやる事":"後でじっくり考える事"}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h3",{className:"font-bold text-gray-800 leading-tight break-words",children:e.title}),(0,r.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gray-500 mt-1",children:[(0,r.jsx)(g.A,{className:"w-3 h-3"}),(0,r.jsx)("span",{className:"font-bold",children:h(e.deletedAt)})]})]})]}),(0,r.jsx)("button",{onClick:()=>f(e),className:"flex-shrink-0 p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded transition-colors",title:"完全に削除",children:(0,r.jsx)(x.A,{className:"w-4 h-4"})})]})},e.id))})}),l.length>0&&(0,r.jsx)("div",{className:"p-6 pt-4 border-t border-gray-100 flex-shrink-0",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 font-bold mb-2",children:"削除されたタスクは30日後に自動的に完全削除されます"}),(0,r.jsxs)("div",{className:"flex items-center justify-center gap-4 text-xs text-gray-500",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:"#FF5F68"}}),(0,r.jsx)("span",{children:"まず最初にやる事"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:"#007AFF"}}),(0,r.jsx)("span",{children:"後でじっくり考える事"})]})]})]})})]}),d&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-60 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl w-full max-w-sm shadow-2xl transform transition-all duration-300 ease-out scale-100 opacity-100",children:[(0,r.jsxs)("div",{className:"p-6 pb-4 text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)(j.A,{className:"w-8 h-8 text-red-600"})}),(0,r.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"完全削除の確認"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 mb-4",children:["このタスクを完全に削除しますか？",(0,r.jsx)("br",{}),"この操作は取り消せません。"]})]}),(0,r.jsx)("div",{className:"px-6 pb-4",children:(0,r.jsx)("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"w-4 h-4 rounded-full flex-shrink-0 mt-0.5",style:{backgroundColor:p(d.category)}}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h4",{className:"font-bold text-gray-800 text-sm leading-tight break-words",children:d.title}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[h(d.deletedAt),"に削除"]})]})]})})}),(0,r.jsxs)("div",{className:"p-6 pt-2 flex gap-3",children:[(0,r.jsx)(u,{variant:"outline",onClick:()=>{m(null)},className:"flex-1 font-bold bg-transparent",children:"キャンセル"}),(0,r.jsx)(u,{onClick:()=>{if(d){let e=l.filter(e=>e.id!==d.id);localStorage.setItem("tokkakari-trash",JSON.stringify(e)),n(e),console.log("Permanently deleted item:",d.id),m(null)}},className:"flex-1 bg-red-600 hover:bg-red-700 text-white font-bold",children:"完全削除"})]})]})})]}):null}var F=a(2138);let R={welcome:{title:"とっかかりプランナーへようこそ！",description:"大きなタスクを小さなステップに分解して、「最初の一歩」を見つけるアプリです。",waitForAction:!1,blockOtherInteractions:!0},"tabs-explanation":{title:"2つのタブで整理",description:"「後でじっくり考える事」タブをクリックしてみましょう。",target:".tab-later",waitForAction:!0,blockOtherInteractions:!0},"tab-switch":{title:"後でじっくり考える事",description:"重要だけど急がないタスクを管理するタブです。",target:".tab-later",waitForAction:!1,blockOtherInteractions:!1},"tab-switch-back":{title:"まず最初にやる事",description:"「まず最初にやる事」タブをクリックして戻りましょう。",target:".tab-immediate",waitForAction:!0,blockOtherInteractions:!0},"simple-task-explanation":{title:"簡単なタスクはそのまま完了",description:"「授業アンケートを提出する」のような簡単なタスクは、分解せずにそのまま完了できます。分解が必要なのは複雑で手順が分からないタスクです。",target:".task-item",waitForAction:!1,blockOtherInteractions:!0},"simple-task-completion":{title:"タスクを完了してみよう",description:"サンプルタスクの○ボタンをクリックして完了してください。",target:".task-check-button",waitForAction:!0,blockOtherInteractions:!0},"undo-explanation":{title:"取り消し機能",description:"間違って完了した時は「取り消し」で元に戻せます。5秒で自動削除されます。",target:".undo-toast",waitForAction:!1,blockOtherInteractions:!1},"add-task-button":{title:"新しいタスクを追加",description:"右下の+ボタンをクリックしてタスクを追加してください。",target:".add-task-button",waitForAction:!0,blockOtherInteractions:!0},"task-form-explanation":{title:"タスクを入力",description:"「プレゼン資料を作成する」と入力して追加してください。",target:".task-form",waitForAction:!0,blockOtherInteractions:!1},"task-breakdown":{title:"分解ボタンをクリック",description:"追加されたタスクの分解ボタンをクリックしてください。",target:".task-breakdown-button",waitForAction:!0,blockOtherInteractions:!0},"breakdown-screen":{title:"分解画面",description:"タスクの詳細をAIに説明します。マイクボタンで音声入力するか、テキストで直接入力してください。",target:".breakdown-container",waitForAction:!1,blockOtherInteractions:!1},"voice-input":{title:"詳細を説明",description:"マイクボタンで音声入力するか、テキストで直接入力してください。",waitForAction:!0,autoHide:!1,blockOtherInteractions:!1},"voice-input-demo":{title:"入力デモ",description:"今回はデモ用に「プレゼン資料作成の詳細（10分発表、10枚スライド、来週金曜締切）」を入力しました。「次へ」をクリックして分解に進みましょう。",target:".tutorial-text-input",waitForAction:!1,blockOtherInteractions:!0},"breakdown-submit":{title:"分解ボタンをクリック",description:"右上の「分解」ボタンをクリックしてAIにタスクを分けてもらいましょう。",target:".breakdown-submit",waitForAction:!0,blockOtherInteractions:!0},"breakdown-results":{title:"分解結果を確認",description:"AIが作成したステップが表示されました。スタートしてみましょう。",target:".start-execution-button",waitForAction:!0,blockOtherInteractions:!0},"start-execution":{title:"実行を開始",description:"右上の「スタート」ボタンをクリックして実行していきましょう。",target:".start-execution-button",waitForAction:!0,blockOtherInteractions:!0},"execution-overview":{title:"実行画面の説明",description:"上部に進捗バーが表示されています。現在0%から始まります。タスクを完了すると進捗が進みます。",target:".execution-container",waitForAction:!1,blockOtherInteractions:!1},"current-task-explanation":{title:"現在のタスク",description:"白い枠で囲まれているのが「現在のタスク」です。この○ボタンをクリックして完了できます。",target:".current-task-item",waitForAction:!1,blockOtherInteractions:!1},"complete-first-task":{title:"最初のタスクを完了",description:"現在のタスクの○ボタンをクリックして完了してください。",target:".current-task-check",waitForAction:!0,blockOtherInteractions:!0,autoHide:!0,autoHideDelay:0},"interrupt-explanation":{title:"中断機能",description:"右上の「中断」ボタンをクリックしてください。進捗は自動保存されるので、後で続きから再開できます。",target:".interrupt-button",waitForAction:!0,blockOtherInteractions:!0},"tutorial-skip-notice":{title:"基本操作をマスター！",description:"基本的な使い方を覚えました！実際の使用では、全てのタスクを完了すると盛大なお祝いが表示されます。",waitForAction:!1,blockOtherInteractions:!0},complete:{title:"チュートリアル完了！",description:"これで基本的な使い方がわかりました。大きなタスクも小さく分解すれば必ず進められます！",waitForAction:!1,blockOtherInteractions:!0}};function O(e){let{isActive:t,currentStep:a,onComplete:o,onSkip:l,onStepComplete:n}=e,[i,c]=(0,s.useState)(!1),[d,m]=(0,s.useState)([]),[x,g]=(0,s.useState)([]),[h,p]=(0,s.useState)(!0),f=R[a];if((0,s.useEffect)(()=>{t?c(!0):(c(!1),m([]),g([])),p(!0)},[t]),(0,s.useEffect)(()=>{p(!0)},[a]),(0,s.useEffect)(()=>{if("complete-first-task"===a&&i&&h){let e=document.querySelector(".current-task-check");if(e){let t=()=>{console.log("Tutorial: Current task check button clicked, hiding tutorial popup"),p(!1)};return e.addEventListener("click",t),()=>{e.removeEventListener("click",t)}}}},[a,i,h]),(0,s.useEffect)(()=>{if(i&&(null==f?void 0:f.autoHide)&&h&&0!==f.autoHideDelay){let e=setTimeout(()=>{p(!1)},f.autoHideDelay||3e3);return()=>clearTimeout(e)}},[i,f,h]),(0,s.useEffect)(()=>{if(!i||!(null==f?void 0:f.target)){m([]),g([]);return}let e=()=>{let t=[],r=[],s=null;if(".task-check-button"===f.target){let e=document.querySelector(".task-item");e&&(s=e.querySelector("button"))}else s=".undo-toast"===f.target?document.querySelector(".undo-toast"):".current-task-check"===f.target?document.querySelector(".current-task-check"):".current-task-item"===f.target?document.querySelectorAll('[class*="bg-white rounded-lg border border-teal-200"]')[0]:document.querySelector(f.target);s&&(t.push(s),r.push(s.getBoundingClientRect())),f.additionalTargets&&f.additionalTargets.forEach(e=>{let a=document.querySelector(e);a&&(t.push(a),r.push(a.getBoundingClientRect()))}),t.length>0?(m(t),g(r),"voice-input"!==a&&"voice-input-demo"!==a&&t[0].scrollIntoView({behavior:"smooth",block:"center"})):setTimeout(e,100)};e()},[f,i,a]),!i||!f||document.querySelector(".celebration-modal")||"task-form-explanation"===a)return null;let b=!f.waitForAction||"voice-input"===a||"voice-input-demo"===a||"tab-switch"===a||"simple-task-explanation"===a||"undo-explanation"===a||"execution-overview"===a||"current-task-explanation"===a;return(0,r.jsxs)(r.Fragment,{children:[f.blockOtherInteractions&&"undo-explanation"!==a&&(0,r.jsx)("div",{className:"fixed inset-0",style:{zIndex:"task-form-explanation"===a?55:"voice-input-demo"===a?10010:9999,pointerEvents:"auto",background:f.target&&x.length>0&&"task-form-explanation"!==a&&"voice-input-demo"!==a?"\n            radial-gradient(\n              ellipse ".concat(x[0].width+20,"px ").concat(x[0].height+20,"px at \n              ").concat(x[0].left+x[0].width/2,"px ").concat(x[0].top+x[0].height/2,"px,\n              transparent 0%,\n              transparent 60%,\n              rgba(0, 0, 0, 0.3) 90%\n            )\n          "):"task-form-explanation"===a||"voice-input-demo"===a?"rgba(0, 0, 0, 0.5)":"rgba(0, 0, 0, 0.3)"},onClick:e=>(e.preventDefault(),e.stopPropagation(),!1),onTouchStart:e=>{e.preventDefault(),e.stopPropagation()},onTouchEnd:e=>{e.preventDefault(),e.stopPropagation()}}),"undo-explanation"===a&&(0,r.jsx)("div",{className:"fixed inset-0",style:{zIndex:10001,pointerEvents:"none",background:"rgba(0, 0, 0, 0.1)"}}),!f.blockOtherInteractions&&"voice-input"!==a&&"voice-input-demo"!==a&&"undo-explanation"!==a&&(0,r.jsx)("div",{className:"fixed inset-0",style:{zIndex:"task-form-explanation"===a?55:9999,pointerEvents:"auto",background:f.target&&x.length>0&&"task-form-explanation"!==a?"\n            radial-gradient(\n              ellipse ".concat(x[0].width+20,"px ").concat(x[0].height+20,"px at \n              ").concat(x[0].left+x[0].width/2,"px ").concat(x[0].top+x[0].height/2,"px,\n              transparent 0%,\n              transparent 60%,\n              rgba(0, 0, 0, 0.2) 90%\n            )\n          "):"task-form-explanation"===a?"transparent":"rgba(0, 0, 0, 0.2)"},onClick:e=>(e.preventDefault(),e.stopPropagation(),!1)}),"voice-input"!==a&&"voice-input-demo"!==a&&"undo-explanation"!==a&&x.map((e,t)=>(0,r.jsx)("div",{className:"fixed",style:{top:e.top-5,left:e.left-5,width:e.width+10,height:e.height+10,zIndex:"task-form-explanation"===a?65:10005,pointerEvents:"auto",background:"transparent"},onClick:e=>{f.waitForAction&&(console.log("Tutorial click area clicked",f.target),d[t]&&d[t].click())}},t)),h&&(0,r.jsxs)("div",{className:"tutorial-popup bg-white rounded-xl shadow-xl border border-teal-200 overflow-hidden border-none",style:{...(()=>{let e,t,r,s,o=window.innerHeight,l=window.innerWidth;if(l<400?(e=l-32,t=.5*o):l<480?(e=l-32,t=.55*o):l<768?(e=Math.min(380,l-32),t=.6*o):(e=Math.min(420,l-32),t=.7*o),e=Math.max(280,e),"undo-explanation"===a)return{position:"fixed",bottom:176,left:Math.max(16,Math.min(l-e-16,(l-e)/2)),width:e,maxHeight:Math.min(160,.2*o),zIndex:10002,pointerEvents:"auto"};if("voice-input"===a||"voice-input-demo"===a)return{position:"fixed",top:76,left:Math.max(16,Math.min(l-e-16,(l-e)/2)),width:e,maxHeight:Math.min(t,o-200),zIndex:10010,pointerEvents:"auto"};if(0===x.length)return{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:e,maxHeight:Math.min(t,o-64),zIndex:10003,pointerEvents:"auto"};let n=x[0];s=Math.max(16,Math.min(l-e-16,(l-e)/2)),r=(o-Math.min(300,t))/2;let i=n.top+n.height/2,c=n.left+n.width/2;return i<o/2?o-n.bottom-16>180&&(r=Math.min(n.bottom+16,o-180-16)):n.top-16>180&&(r=Math.max(16,n.top-200)),c<.3*l?s=Math.min(l-e-16,Math.max(16,l-e-16)):c>.7*l&&(s=Math.max(16,Math.min(l-e-16,16))),{position:"fixed",top:r=Math.max(16,Math.min(o-Math.min(t,200)-16,r)),left:s=Math.max(16,Math.min(l-e-16,s)),width:e,maxHeight:Math.min(t,o-r-16),zIndex:10003,pointerEvents:"auto"}})(),zIndex:"undo-explanation"===a?10002:"breakdown-screen"===a||"voice-input"===a||"voice-input-demo"===a?10010:"execution-overview"===a||"current-task-explanation"===a?10015:10003,display:"flex",flexDirection:"column"},children:[(0,r.jsx)("div",{className:"flex justify-between items-center p-3 pb-2 border-b border-gray-100 flex-shrink-0",style:{backgroundColor:"#E3F2FD"},children:(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"w-5 h-5 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0",style:{backgroundColor:"#0288D1"},children:"?"}),(0,r.jsx)("h3",{className:"text-sm font-bold truncate tutorial-title",style:{color:"#263238"},children:f.title})]})}),(0,r.jsxs)("div",{className:"tutorial-popup-content flex-1 overflow-y-auto p-3 min-h-0",children:[(0,r.jsx)("p",{className:"leading-relaxed text-sm mb-2 font-bold",style:{color:"#263238"},children:f.description}),"tabs-explanation"===a&&(0,r.jsx)("div",{className:"border border-orange-200 rounded-lg p-2",style:{backgroundColor:"#fff7ed"},children:(0,r.jsx)("p",{className:"text-xs font-bold",style:{color:"#e8580c"},children:"\uD83D\uDCA1 タブを切り替えてタスクを整理しましょう"})}),"tab-switch"===a&&(0,r.jsx)("div",{className:"border border-orange-200 rounded-lg p-2",style:{backgroundColor:"#fff7ed"},children:(0,r.jsx)("p",{className:"text-xs font-bold",style:{color:"#e8580c"},children:"例：スキルアップ、将来の計画、趣味など"})}),"tab-switch-back"===a&&(0,r.jsx)("div",{className:"border border-orange-200 rounded-lg p-2",style:{backgroundColor:"#fff7ed"},children:(0,r.jsx)("p",{className:"text-xs font-bold",style:{color:"#e8580c"},children:"例：緊急性の高いタスク、締切が近いもの"})}),"simple-task-explanation"===a&&(0,r.jsx)("div",{className:"border border-orange-200 rounded-lg p-2",style:{backgroundColor:"#fff7ed"},children:(0,r.jsx)("p",{className:"text-xs font-bold",style:{color:"#e8580c"},children:"\uD83D\uDCA1 簡単 = そのまま完了、複雑 = 分解してから実行"})}),"simple-task-completion"===a&&(0,r.jsx)("div",{className:"border border-orange-200 rounded-lg p-2",style:{backgroundColor:"#fff7ed"},children:(0,r.jsx)("p",{className:"text-xs font-bold",style:{color:"#e8580c"},children:"✓ 簡単なタスクはすぐに完了しましょう"})}),"undo-explanation"===a&&(0,r.jsx)("div",{className:"border border-orange-200 rounded-lg p-2",style:{backgroundColor:"#fff7ed"},children:(0,r.jsx)("p",{className:"text-xs font-bold",style:{color:"#e8580c"},children:"※チュートリアル中のため取り消しはできません"})}),"voice-input"===a&&(0,r.jsx)("div",{className:"border border-orange-200 rounded-lg p-2",style:{backgroundColor:"#fff7ed"},children:(0,r.jsx)("p",{className:"text-xs font-bold",style:{color:"#e8580c"},children:"\uD83D\uDCA1 詳しく話すほど、より実用的なステップに分解されます"})}),"voice-input-demo"===a&&(0,r.jsx)("div",{className:"border border-orange-200 rounded-lg p-2",style:{backgroundColor:"#fff7ed"},children:(0,r.jsx)("p",{className:"text-xs font-bold",style:{color:"#e8580c"},children:"\uD83D\uDCA1 実際の使用では、ここでご自身のタスクの詳細を説明してください"})}),"execution-overview"===a&&(0,r.jsx)("div",{className:"border border-orange-200 rounded-lg p-2",style:{backgroundColor:"#fff7ed"},children:(0,r.jsx)("p",{className:"text-xs font-bold",style:{color:"#e8580c"},children:"進捗バーでタスクの完了状況を確認できます"})}),"current-task-explanation"===a&&(0,r.jsx)("div",{className:"border border-orange-200 rounded-lg p-2",style:{backgroundColor:"#fff7ed"},children:(0,r.jsx)("p",{className:"text-xs font-bold",style:{color:"#e8580c"},children:"現在のタスクのみクリックして完了できます"})}),"complete-first-task"===a&&(0,r.jsx)("div",{className:"border border-orange-200 rounded-lg p-2",style:{backgroundColor:"#fff7ed"},children:(0,r.jsx)("p",{className:"text-xs font-bold",style:{color:"#e8580c"},children:"○ボタンをクリックするとお祝いが表示されます"})}),"interrupt-explanation"===a&&(0,r.jsx)("div",{className:"border border-orange-200 rounded-lg p-2",style:{backgroundColor:"#fff7ed"},children:(0,r.jsx)("p",{className:"text-xs font-bold",style:{color:"#e8580c"},children:"進捗は保存されるので安心して中断できます"})}),"tutorial-skip-notice"===a&&(0,r.jsx)("div",{className:"border border-orange-200 rounded-lg p-2",style:{backgroundColor:"#fff7ed"},children:(0,r.jsx)("p",{className:"text-xs font-bold",style:{color:"#e8580c"},children:"\uD83C\uDF89 タスクの追加・分解・実行をマスターしました！"})}),"task-breakdown"===a&&(0,r.jsx)("div",{className:"border border-orange-200 rounded-lg p-2",style:{backgroundColor:"#fff7ed"},children:(0,r.jsx)("p",{className:"text-xs font-bold",style:{color:"#e8580c"},children:"AIが自動で手順を作成します"})})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center p-3 pt-2 border-t border-gray-100 flex-shrink-0",style:{backgroundColor:"#E3F2FD"},children:[(0,r.jsx)("div",{}),b&&(0,r.jsxs)(u,{onClick:()=>{console.log("Next button clicked for step:",a),"complete"===a||"tutorial-skip-notice"===a?o():n(a)},className:"text-white flex items-center gap-1 text-sm px-3 py-1 ml-auto font-bold",style:{backgroundColor:"#0288D1",pointerEvents:"auto",zIndex:10020},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#0277BD",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#0288D1",children:["complete"===a||"tutorial-skip-notice"===a?"完了":"次へ",(0,r.jsx)(F.A,{className:"w-3 h-3"})]}),f.waitForAction&&"voice-input"!==a&&"voice-input-demo"!==a&&"undo-explanation"!==a&&"execution-overview"!==a&&"current-task-explanation"!==a&&(0,r.jsx)("div",{className:"text-xs font-bold flex items-center gap-1 ml-auto status-text",style:{color:"#0288D1"}})]})]})]})}let M=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("textarea",{className:(0,c.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...s})});M.displayName="Textarea";let P=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,c.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});P.displayName="Card",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,c.cn)("flex flex-col space-y-1.5 p-6",a),...s})}).displayName="CardHeader",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,c.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})}).displayName="CardTitle",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,c.cn)("text-sm text-muted-foreground",a),...s})}).displayName="CardDescription";let z=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,c.cn)("p-6 pt-0",a),...s})});z.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,c.cn)("flex items-center p-6 pt-0",a),...s})}).displayName="CardFooter";var _=a(1154),B=a(5339),H=a(1951),K=a(9588);let L=(0,i.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Y=s.forwardRef((e,t)=>{let{className:a,variant:s,...o}=e;return(0,r.jsx)("div",{ref:t,role:"alert",className:(0,c.cn)(L({variant:s}),a),...o})});Y.displayName="Alert",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("h5",{ref:t,className:(0,c.cn)("mb-1 font-medium leading-none tracking-tight",a),...s})}).displayName="AlertTitle";let W=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,c.cn)("text-sm [&_p]:leading-relaxed",a),...s})});W.displayName="AlertDescription";var U=a(8021);let G=["やったニャ！！今この瞬間、世界でいちばんえらいニャ！！","すごいニャすごいニャ！！伝説のタスク、ほんとに終わったニャ！？信じられないニャ！！","その成し遂げたそれ、尊すぎてしっぽが感電したニャ。","もしかして神？いや、今日だけは神ニャ。","この喜び、猫のゴロゴロ音の最大級バージョンニャ！聴こえるニャ？","喜びの舞いを始めてしまったニャ……ああ……止まらないニャ……！！","すばらしいニャ！！この感動は永久保存ニャ！タンスの奥にしまっておくニャ！","やったこと、詩にして後世に伝えるニャ……第一章「たすく完遂の章」ニャ。","信じられないニャ！こんなことってあるニャ！？猫生最大の衝撃ニャ！","すごすぎて言葉が出ないニャ……ただただ、圧倒的ニャ……！","この達成、猫界の歴史に刻まれるニャ！伝説誕生の瞬間ニャ！","やったニャ！やったニャ！やったニャー！重要なので三回言いましたニャ！","この喜び、全宇宙の猫と分かち合いたいニャ！通信回線繋ぐニャ！","信じられニャい……まさか……本当に……やったニャアアアア！！！","この感動をどう表現すればいいか、猫語辞典にも載ってないニャ！","この偉業を称え、今から盛大に猫缶パーティーを開催するニャ！","もはや言葉はいらないニャ……ただただ、ひれ伏すのみニャ……！","この達成、猫の教科書に載せるべきニャ！全猫必修科目ニャ！","やったニャ！やったニャ！やったニャ！嬉しすぎて踊り狂うニャ！","この感動、猫まっしぐらニャ！猫まっしぐら！猫まっしぐらニャ！","信じられないニャ！こんなすごいことって、本当に起こるんだニャ！","やったニャ！やったニャ！やったニャ！嬉しすぎて、もう一回言っちゃったニャ！","この達成、猫の神様も祝福してるニャ！きっとそうだニャ！","信じられないニャ！こんなすごいこと、猫にも真似できないニャ！","この感動、猫の魂に刻み込むニャ！一生忘れないニャ！","やったニャ！やったニャ！やったニャ！嬉しすぎて、涙がちょちょぎれるニャ！","この達成、猫界の宝ニャ！大切にするニャ！","信じられないニャ！こんなすごいこと、猫の想像を遥かに超えているニャ！","やばいニャ！やばすぎるニャ！感動のあまり、背中の毛が逆立ったニャ！今日からここは聖地ニャ！","ひゃっほーい！この喜び、猫の尻尾がプロペラみたいに回っちゃうニャ！空飛べそうニャ！"],J=["/images/cat-celebration-1.png","/images/cat-celebration-2.png","/images/cat-celebration-3.jpg"];function X(e){let{isOpen:t,onClose:a,taskTitle:o,onCompleteTask:l,tutorialStep:n,onTutorialStepComplete:i}=e,[c,d]=(0,s.useState)(""),[m,x]=(0,s.useState)(""),[g,h]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(t){let e=G[Math.floor(Math.random()*G.length)],t=J[Math.floor(Math.random()*J.length)];d(e),x(t),h(!0)}else h(!1)},[t]),(0,s.useEffect)(()=>{if(t&&"complete-first-task"===n){let e=setTimeout(()=>{console.log("Tutorial: Auto-progressing after 3 seconds"),p()},3e3);return()=>clearTimeout(e)}},[t,n]);let p=()=>{console.log("Celebration modal Next button clicked or auto-progressed, tutorialStep:",n),"complete-first-task"===n&&i?(console.log("Tutorial: Moving to interrupt-explanation step"),a(),l&&l(),setTimeout(()=>{i("complete-first-task")},100)):(a(),l&&l())};return t?(0,r.jsx)("div",{className:"celebration-modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:5e4},children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl w-full max-w-sm transform transition-all duration-300 ease-out ".concat(g?"opacity-100 scale-100":"opacity-0 scale-95"),style:{maxHeight:"80vh",display:"flex",flexDirection:"column",zIndex:50001},children:[(0,r.jsxs)("div",{className:"flex-1 p-6 text-center",style:{overflowY:"auto",minHeight:0},children:[(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsx)("img",{src:m||"/placeholder.svg",alt:"お祝い猫",className:"w-32 h-32 mx-auto object-contain"})}),(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)("h2",{className:"text-lg font-bold text-teal-600 mb-4",children:"タスク完了！"})}),(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)("p",{className:"text-base leading-relaxed text-gray-800 font-bold celebration-message",children:c})})]}),(0,r.jsx)("div",{className:"flex-shrink-0 p-6 pt-0 border-t border-gray-100",children:(0,r.jsx)(u,{onClick:p,className:"w-full bg-teal-600 hover:bg-teal-700 text-white font-bold",style:{zIndex:50002},children:"次へ"})})]})}):null}let q=["\uD83C\uDF89 信じられないニャ！！全部やり遂げたニャ！！ \uD83C\uDF89","\uD83C\uDF1F これぞまさに伝説の瞬間ニャ！！猫も驚愕ニャ！！ \uD83C\uDF1F","\uD83C\uDF8A 完璧すぎて言葉が出ないニャ！！宇宙一すごいニャ！！ \uD83C\uDF8A","\uD83C\uDFC6 今日という日を永遠に記憶するニャ！！歴史的快挙ニャ！！ \uD83C\uDFC6","⭐ もはや神の領域ニャ！！猫界の教科書に載せるニャ！！ ⭐","\uD83C\uDFAF 完全制覇ニャ！！この感動を全宇宙に伝えたいニャ！！ \uD83C\uDFAF","✨ ダイヤモンドより輝いてるニャ！！眩しすぎるニャ！！ ✨","\uD83D\uDE80 もう地球を飛び出しそうな勢いニャ！！宇宙デビューニャ！！ \uD83D\uDE80"],V=["/images/cat-celebration-1.png","/images/cat-celebration-2.png","/images/cat-celebration-3.jpg"];function Q(e){let{isOpen:t,onClose:a,taskTitle:o,onCompleteAllTasks:l}=e,[n,i]=(0,s.useState)(""),[c,d]=(0,s.useState)(""),[m,x]=(0,s.useState)(!1),[g,h]=(0,s.useState)(!1),[p,f]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{if(t){let e=q[Math.floor(Math.random()*q.length)],t=V[Math.floor(Math.random()*V.length)];i(e),d(t),setTimeout(()=>x(!0),100),setTimeout(()=>h(!0),500),setTimeout(()=>f(!0),800)}else x(!1),h(!1),f(!1)},[t]),t)?(0,r.jsxs)("div",{className:"fixed inset-0 bg-gradient-to-br from-teal-100 via-teal-50 to-white flex items-center justify-center z-50 p-4 overflow-hidden",children:[p&&(0,r.jsx)("div",{className:"absolute inset-0 pointer-events-none z-0",children:[...Array(30)].map((e,t)=>(0,r.jsx)("div",{className:"absolute w-1.5 h-1.5 animate-bounce opacity-60",style:{left:"".concat(100*Math.random(),"%"),top:"-10px",backgroundColor:["#14b8a6","#0d9488","#0f766e","#a7f3d0","#5eead4"][Math.floor(5*Math.random())],animationDelay:"".concat(3*Math.random(),"s"),animationDuration:"".concat(2+3*Math.random(),"s"),transform:"rotate(".concat(360*Math.random(),"deg)")}},t))}),g&&(0,r.jsx)("div",{className:"absolute inset-0 pointer-events-none z-0",children:[...Array(6)].map((e,t)=>(0,r.jsx)("div",{className:"absolute w-3 h-3 rounded-full animate-ping opacity-40",style:{left:"".concat(20+60*Math.random(),"%"),top:"".concat(20+60*Math.random(),"%"),backgroundColor:["#14b8a6","#0d9488","#0f766e","#a7f3d0"][Math.floor(4*Math.random())],animationDelay:"".concat(2*Math.random(),"s"),animationDuration:"".concat(1+2*Math.random(),"s")}},t))}),(0,r.jsx)("div",{className:"absolute inset-0 pointer-events-none z-0",children:[...Array(15)].map((e,t)=>(0,r.jsx)("div",{className:"absolute text-teal-400 animate-pulse opacity-50",style:{left:"".concat(100*Math.random(),"%"),top:"".concat(100*Math.random(),"%"),fontSize:"".concat(10+16*Math.random(),"px"),animationDelay:"".concat(3*Math.random(),"s"),animationDuration:"".concat(1+2*Math.random(),"s")},children:"✨"},t))}),(0,r.jsxs)("div",{className:"bg-white rounded-3xl w-full max-w-lg transform transition-all duration-1000 ease-out ".concat(m?"opacity-100 scale-100 rotate-0":"opacity-0 scale-50 rotate-6"," shadow-2xl border-2 border-teal-200 z-10 relative"),style:{maxHeight:"85vh",display:"flex",flexDirection:"column"},children:[(0,r.jsxs)("div",{className:"text-center p-6 pb-4 bg-gradient-to-b from-teal-50 to-white rounded-t-3xl",children:[(0,r.jsx)("div",{className:"text-5xl mb-4 animate-bounce",children:"\uD83C\uDFC6"}),(0,r.jsx)("h1",{className:"text-2xl font-bold mb-2 text-teal-700",children:"\uD83C\uDF89 完全制覇！ \uD83C\uDF89"}),(0,r.jsxs)("div",{className:"text-lg font-bold text-teal-600",children:["「",o,"」"]})]}),(0,r.jsxs)("div",{className:"flex-1 p-6 pt-2 text-center overflow-y-auto",style:{minHeight:0},children:[(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsxs)("div",{className:"relative inline-block",children:[(0,r.jsx)("img",{src:c||"/placeholder.svg",alt:"盛大なお祝い猫",className:"w-32 h-32 mx-auto object-contain rounded-full border-3 border-teal-300 shadow-lg transform transition-all duration-1000 ".concat(m?"scale-100 rotate-0":"scale-0 rotate-180")}),(0,r.jsx)("div",{className:"absolute -top-1 -right-1 text-2xl animate-spin",children:"\uD83C\uDF1F"}),(0,r.jsx)("div",{className:"absolute -bottom-1 -left-1 text-2xl animate-bounce",children:"\uD83C\uDF8A"})]})}),(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)("div",{className:"bg-teal-50 rounded-2xl p-6 border border-teal-200",children:(0,r.jsx)("p",{className:"text-lg leading-relaxed font-bold text-teal-800 celebration-message",children:n})})})]}),(0,r.jsx)("div",{className:"p-6 pt-4 border-t border-teal-100 bg-gradient-to-t from-teal-50 to-white rounded-b-3xl",children:(0,r.jsx)(u,{onClick:()=>{a(),l&&l()},className:"w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-4 text-lg rounded-xl shadow-lg transform transition-all duration-200 hover:scale-105",children:"ホームに戻る"})})]}),(0,r.jsx)("div",{className:"absolute top-10 left-10 text-4xl animate-bounce opacity-60 z-0",style:{animationDelay:"0.5s"},children:"\uD83C\uDF89"}),(0,r.jsx)("div",{className:"absolute top-20 right-10 text-3xl animate-bounce opacity-60 z-0",style:{animationDelay:"1s"},children:"\uD83C\uDF8A"}),(0,r.jsx)("div",{className:"absolute bottom-20 left-20 text-3xl animate-bounce opacity-60 z-0",style:{animationDelay:"1.5s"},children:"\uD83C\uDF1F"}),(0,r.jsx)("div",{className:"absolute bottom-10 right-20 text-4xl animate-bounce opacity-60 z-0",style:{animationDelay:"2s"},children:"\uD83C\uDFC6"})]}):null}function $(){return(0,r.jsxs)("div",{className:"flex justify-between items-center bg-white text-black text-sm font-medium py-0 px-4",children:[(0,r.jsx)("div",{})," ",(0,r.jsx)("div",{})," "]})}function Z(e){let{task:t,generatedTasks:a,onBack:o,onAddTask:n,onBackToHome:i,onTaskCompleted:c,tutorialStep:d,onTutorialStepComplete:m}=e,[g,h]=(0,s.useState)(Array(a.length).fill(!1)),[p,f]=(0,s.useState)(0),[b,v]=(0,s.useState)(!1),[k,y]=(0,s.useState)(!1),[j,N]=(0,s.useState)(""),[C,A]=(0,s.useState)(a),[T,E]=(0,s.useState)(!1),I=(0,s.useRef)(null),F=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=S(t.id);if(e&&e.generatedTasks.length>0)h(e.completed),f(e.currentIndex),A(e.generatedTasks),console.log("Progress restored:",e);else if(a.length>0){let e={completed:Array(a.length).fill(!1),currentIndex:0,timestamp:Date.now(),generatedTasks:a};D(t.id,e),h(e.completed),f(0),A(a),console.log("Initial progress saved:",e)}},[t.id,a]),(0,s.useEffect)(()=>{if(C.length>0){let e={completed:g,currentIndex:p,timestamp:Date.now(),generatedTasks:C};D(t.id,e),console.log("Progress saved:",e)}},[g,p,t.id,C]),(0,s.useEffect)(()=>{g.filter(Boolean).length===C.length&&C.length>0&&!T&&E(!0)},[g,C.length,T]),(0,s.useEffect)(()=>{I.current&&F.current&&setTimeout(()=>{var e;null==(e=I.current)||e.scrollIntoView({behavior:"smooth",block:"center"})},100)},[p]);let R=(e,t)=>{if(!d)return!0;switch(d){case"execution-overview":case"current-task-explanation":default:return!1;case"complete-first-task":return"task-check"===e&&0===t;case"interrupt-explanation":return"interrupt"===e}},O=e=>{let a=[...g];if(a[e]){a[e]=!1,h(a),E(!1);let t=a.findIndex(e=>!e);f(-1===t?C.length:t)}else{if(e!==p)return;a[e]=!0,h(a);let r=a.findIndex((t,a)=>!t&&a>e);f(-1===r?C.length:r),a.filter(Boolean).length===C.length?(N(t.title),y(!0)):(N(C[e]),v(!0),"complete-first-task"===d&&0===e&&m&&console.log("Tutorial: First task completed, will progress after celebration modal"))}},M=g.filter(Boolean).length,P=Math.round(M/C.length*100),{completedTasksGroup:z,currentTaskGroup:_,futureTasksGroup:B}=(()=>{let e=[],t=[],a=[];return C.forEach((r,s)=>{g[s]?e.push({text:r,originalIndex:s}):s===p?t.push({text:r,originalIndex:s}):s>p&&a.push({text:r,originalIndex:s})}),{completedTasksGroup:e,currentTaskGroup:t,futureTasksGroup:a}})(),H=function(e,t){var a;let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{text:o,originalIndex:l}=e,n=g[l],i=l===p||n;return(0,r.jsxs)("div",{className:"flex items-start",ref:s?I:null,children:[(0,r.jsxs)("div",{className:"flex flex-col items-center mr-4 mt-2 flex-shrink-0",children:[(0,r.jsx)("button",{onClick:()=>O(l),disabled:!i||!!(d&&!R("task-check",l)),className:"current-task-check w-8 h-8 rounded-full border-2 flex items-center justify-center transition-all duration-200 ".concat(n?"bg-teal-600 border-teal-600 cursor-pointer hover:bg-teal-700":s?"border-teal-400 bg-white hover:border-teal-500 cursor-pointer current-task-button":"border-gray-200 bg-gray-100 cursor-not-allowed opacity-50"," ").concat(d&&!R("task-check",l)?"opacity-30 cursor-not-allowed":""),children:n&&(0,r.jsx)(w.A,{className:"w-4 h-4 text-white"})}),!t&&(0,r.jsx)("div",{className:"w-0.5 h-16 mt-2 transition-colors duration-300 ".concat(n?"bg-teal-300":"bg-gray-200")})]}),(0,r.jsx)("div",{className:"flex-1 min-w-0",children:(0,r.jsxs)("div",{className:"pb-8 transition-all duration-200 ".concat(s?"bg-white rounded-lg border border-teal-200 p-4 shadow-sm current-task-item":"py-2"),children:[o.includes("ヒント：")?(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("p",{className:"leading-relaxed break-words transition-colors duration-200 font-extrabold text-base ".concat(n?"text-gray-500 line-through":s?"text-gray-900":"text-gray-400"),children:o.split("ヒント：")[0].trim()}),!n&&s&&(0,r.jsx)("div",{className:"rounded-lg p-3 border bg-gray-100 border-gray-300",children:(0,r.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,r.jsx)("span",{className:"flex-shrink-0 text-blue-600 font-semibold text-sm",children:"\uD83D\uDCA1"}),(0,r.jsx)("span",{className:"leading-relaxed font-medium text-sm text-slate-900",children:null==(a=o.split("ヒント：")[1])?void 0:a.trim()})]})})]}):(0,r.jsx)("p",{className:"text-base leading-relaxed break-words transition-colors duration-200 font-bold ".concat(n?"text-gray-500 line-through":s?"text-gray-900":"text-gray-400"),children:o}),s&&(0,r.jsxs)("div",{className:"mt-2 text-sm text-teal-600 font-bold flex items-center gap-2 current-task-text",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-teal-600 rounded-full animate-pulse"}),"現在のタスク"]}),n&&(0,r.jsx)("button",{onClick:()=>O(l),className:"mt-2 text-xs text-gray-400 hover:text-gray-600 transition-colors cursor-pointer font-bold",children:"クリックで未完了に戻す"})]})})]},"".concat(l,"-").concat(o))};return(0,r.jsxs)("div",{className:"execution-container h-screen bg-gray-50 flex flex-col overflow-hidden",children:[(0,r.jsx)($,{}),(0,r.jsxs)("div",{className:"bg-white px-4 py-4 flex items-center justify-between border-b flex-shrink-0",children:[(0,r.jsx)(u,{variant:"ghost",size:"icon",onClick:()=>{if(C.length>0){let e={completed:g,currentIndex:p,timestamp:Date.now(),generatedTasks:C};D(t.id,e),console.log("Progress saved before back to results:",e)}o()},className:"text-black hover:bg-gray-100",children:(0,r.jsx)("img",{src:"/images/back-arrow.png",alt:"戻る",className:"w-6 h-6",style:{filter:"brightness(0) saturate(100%) invert(27%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(95%) contrast(85%)"}})}),(0,r.jsx)("h1",{className:"text-lg font-bold text-center flex-1",children:t.title}),(0,r.jsxs)(u,{variant:"ghost",size:"sm",onClick:()=>{if(console.log("Tutorial: Interrupt button clicked, tutorialStep:",d),"interrupt-explanation"===d&&m&&(console.log("Tutorial: Moving to tutorial-skip-notice step"),m("interrupt-explanation")),C.length>0){let e={completed:g,currentIndex:p,timestamp:Date.now(),generatedTasks:C};D(t.id,e),console.log("Progress saved before interrupt:",e)}i&&i()},disabled:!!(d&&!R("interrupt")),className:"interrupt-button text-gray-600 hover:bg-gray-100 px-3 py-1 text-sm font-bold ".concat(d&&!R("interrupt")?"opacity-30 cursor-not-allowed":""),children:[(0,r.jsx)(x.A,{className:"w-4 h-4 mr-1"}),"中断"]})]}),(0,r.jsxs)("div",{className:"bg-white px-4 py-6 border-b flex-shrink-0",children:[(0,r.jsx)("div",{className:"flex items-center justify-center mb-4",children:(0,r.jsxs)("div",{className:"bg-teal-600 text-white px-3 py-1 rounded-full text-sm font-bold progress-percentage",children:[P,"%"]})}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,r.jsx)("div",{className:"bg-teal-600 h-3 rounded-full transition-all duration-500 ease-out",style:{width:"".concat(P,"%")}})})]}),(0,r.jsx)("div",{ref:F,className:"flex-1 overflow-y-auto min-h-0",children:(0,r.jsxs)("div",{className:"p-4 pb-32",children:[(0,r.jsxs)("div",{className:"space-y-0",children:[z.map((e,t)=>H(e,t===z.length-1&&0===_.length&&0===B.length)),_.map((e,t)=>H(e,t===_.length-1&&0===B.length,!0)),B.map((e,t)=>H(e,t===B.length-1))]}),M===C.length&&C.length>0&&(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("div",{className:"text-4xl mb-4 animate-bounce",children:"\uD83C\uDF89"}),(0,r.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"すべてのタスクが完了しました！"}),(0,r.jsx)("p",{className:"text-gray-600 text-sm font-bold",children:"お疲れさまでした。素晴らしい成果です！"})]})]})}),(0,r.jsx)(u,{className:"fixed bottom-8 right-6 w-14 h-14 rounded-full shadow-lg bg-teal-600 hover:bg-teal-700 z-10 font-bold",size:"icon",onClick:()=>n("追加タスク ".concat(C.length+1)),children:(0,r.jsx)(l.A,{className:"w-6 h-6 text-white"})}),(0,r.jsx)(X,{isOpen:b,onClose:()=>{v(!1)},taskTitle:j,onCompleteTask:()=>{"complete-first-task"===d&&m&&(console.log("Tutorial: Celebration complete, progressing to interrupt-explanation"),m("complete-first-task"))},tutorialStep:d,onTutorialStepComplete:m}),(0,r.jsx)(Q,{isOpen:k,onClose:()=>{y(!1)},taskTitle:j,onCompleteAllTasks:()=>{c&&i&&(i(),setTimeout(()=>{c(t.id)},3e3))}})]})}function ee(e){let{task:t,generatedTasks:a,onBack:o,onStart:n,onTasksGenerated:i,onBackToHome:c,onTaskCompleted:d,tutorialStep:m,onTutorialStepComplete:x}=e,[g,h]=(0,s.useState)(a),[p,f]=(0,s.useState)(null),[b,v]=(0,s.useState)(""),[k,y]=(0,s.useState)(null),[w,j]=(0,s.useState)(null),[N,S]=(0,s.useState)(!1),[D,C]=(0,s.useState)(null),[A,T]=(0,s.useState)(!1),E=(0,s.useRef)(null),[I,F]=(0,s.useState)({x:0,y:0});(0,s.useEffect)(()=>{},[m,x]),(0,s.useEffect)(()=>{"start-execution"===m&&N&&setTimeout(()=>{x&&x("start-execution")},500)},[N,m,x]),(0,s.useEffect)(()=>{"task-edit"===m&&null!==p&&setTimeout(()=>{x&&x("task-edit")},1e3)},[p,m,x]),(0,s.useEffect)(()=>{"task-reorder"===m&&null!==k&&setTimeout(()=>{x&&x("task-reorder")},2e3)},[k,m,x]);let R=(e,t)=>{!t.target.closest(".drag-handle")&&(A||(f(e),v(g[e])))},O=()=>{if(null!==p&&b.trim()){let e=[...g];e[p]=b.trim(),h(e)}f(null),v("")},M=e=>{console.log("Deleting task at index:",e,"Current tasks:",g);let t=g.filter((t,a)=>a!==e);console.log("New tasks after deletion:",t),h(t),f(null),v(""),0===t.length&&console.log("All tasks deleted, returning to previous screen")},P=(e,t)=>{y(t),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",e.currentTarget.outerHTML),setTimeout(()=>{let t=e.target;t.style.opacity="0.5",t.style.transform="rotate(2deg) scale(1.02)",t.style.transition="all 0.2s ease"},0)},z=e=>{let t=e.target;t.style.opacity="1",t.style.transform="none",t.style.transition="all 0.3s ease",y(null),j(null)},_=(e,t)=>{if(e.preventDefault(),e.dataTransfer.dropEffect="move",null!==k&&k!==t){let a=e.currentTarget.getBoundingClientRect(),r=e.clientY-a.top;j({index:t,position:r<a.height/2?"before":"after"})}},B=e=>{e.currentTarget.contains(e.relatedTarget)||j(null)},H=(e,t)=>{if(e.preventDefault(),null!==k&&w){let e=[...g],t=e[k];e.splice(k,1);let a=w.index;k<w.index&&(a-=1),"after"===w.position&&(a+=1),e.splice(a,0,t),h(e)}y(null),j(null)},K=(e,t)=>{if(!e.target.closest(".drag-handle"))return;e.preventDefault();let a=e.touches[0],r=e.currentTarget.getBoundingClientRect();C(a.clientY),y(t),T(!1),F({x:a.clientX-r.left,y:a.clientY-r.top}),E.current=e.currentTarget},L=(e,t)=>{if(k!==t||null===D)return;e.preventDefault();let a=e.touches[0];if(!A&&Math.abs(a.clientY-D)>10&&(T(!0),E.current&&(E.current.style.position="fixed",E.current.style.zIndex="1000",E.current.style.pointerEvents="none",E.current.style.opacity="0.9",E.current.style.transform="rotate(2deg) scale(1.02)",E.current.style.transition="transform 0.2s ease",E.current.style.boxShadow="0 10px 25px rgba(0,0,0,0.3)")),A&&E.current){E.current.style.left="".concat(a.clientX-I.x,"px"),E.current.style.top="".concat(a.clientY-I.y,"px");let e=document.elementsFromPoint(a.clientX,a.clientY).find(e=>e.classList.contains("task-item")&&e!==E.current);if(e){let t=Number.parseInt(e.getAttribute("data-index")||"-1");if(-1!==t&&t!==k){let r=e.getBoundingClientRect(),s=a.clientY-r.top;j({index:t,position:s<r.height/2?"before":"after"})}else j(null)}else j(null)}},Y=(e,t)=>{if(k===t){if(e.preventDefault(),A&&w&&null!==k){let e=[...g],t=e[k];e.splice(k,1);let a=w.index;k<w.index&&(a-=1),"after"===w.position&&(a+=1),e.splice(a,0,t),h(e)}E.current&&(E.current.style.position="static",E.current.style.opacity="1",E.current.style.transform="none",E.current.style.zIndex="auto",E.current.style.pointerEvents="auto",E.current.style.boxShadow="none",E.current.style.transition="all 0.3s ease"),C(null),y(null),j(null),T(!1),F({x:0,y:0}),E.current=null}};return N?(0,r.jsx)(Z,{task:t,generatedTasks:g,onBack:()=>{S(!1)},onAddTask:e=>{h([...g,e])},onBackToHome:c,onTaskCompleted:d,tutorialStep:m,onTutorialStepComplete:x}):(0,r.jsxs)("div",{className:"breakdown-results h-screen bg-gray-50 flex flex-col overflow-hidden",children:[(0,r.jsx)($,{}),(0,r.jsxs)("div",{className:"bg-teal-600 px-4 py-4 flex items-center justify-between flex-shrink-0",children:[(0,r.jsx)(u,{variant:"ghost",size:"icon",onClick:o,className:"text-white hover:bg-teal-700",children:(0,r.jsx)("img",{src:"/images/back-arrow.png",alt:"戻る",className:"w-6 h-6 filter brightness-0 invert"})}),(0,r.jsx)(u,{variant:"outline",className:"start-execution-button text-teal-600 border-white bg-white hover:bg-gray-100",onClick:()=>{"breakdown-results"===m&&x&&x("breakdown-results");let e={completed:Array(g.length).fill(!1),currentIndex:0,timestamp:Date.now(),generatedTasks:g},a="task-progress-".concat(t.id);localStorage.setItem(a,JSON.stringify(e)),S(!0)},children:"スタート"})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0",children:(0,r.jsxs)("div",{className:"p-4 pb-32",children:[(0,r.jsx)("h1",{className:"text-xl font-bold text-teal-600 mb-2",children:t.title}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,r.jsx)("span",{className:"text-lg",children:"\uD83D\uDCA1"}),(0,r.jsxs)("p",{className:"text-gray-600 text-sm",children:["クリックで編集、",(0,r.jsx)("span",{className:"hidden sm:inline",children:"ドラッグで並び替え"}),(0,r.jsx)("span",{className:"sm:hidden",children:"ハンドルをドラッグで並び替え"}),"ができます"]})]}),(0,r.jsx)("div",{className:"space-y-2",children:g.map((e,t)=>{var a;return(0,r.jsxs)("div",{className:"relative",children:[(null==w?void 0:w.index)===t&&"before"===w.position&&(0,r.jsxs)("div",{className:"absolute -top-1 left-0 right-0 h-0.5 bg-teal-500 rounded-full z-10 animate-pulse",children:[(0,r.jsx)("div",{className:"absolute left-2 -top-1 w-2 h-2 bg-teal-500 rounded-full"}),(0,r.jsx)("div",{className:"absolute right-2 -top-1 w-2 h-2 bg-teal-500 rounded-full"})]}),(0,r.jsx)("div",{"data-index":t,className:"task-item bg-white rounded-lg border transition-all duration-300 ".concat(k===t&&A?"opacity-30":""," ").concat(p===t?"ring-2 ring-teal-500":"hover:bg-gray-50 hover:shadow-md"," ").concat((null==w?void 0:w.index)===t?"transform scale-102":""),draggable:p!==t,onDragStart:e=>P(e,t),onDragEnd:z,onDragOver:e=>_(e,t),onDragLeave:B,onDrop:e=>H(e,t),onTouchStart:e=>K(e,t),onTouchMove:e=>L(e,t),onTouchEnd:e=>Y(e,t),children:p===t?(0,r.jsx)("div",{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("span",{className:"text-teal-600 font-bold text-lg min-w-[24px]",children:[t+1,"."]}),(0,r.jsx)("textarea",{value:b,onChange:e=>v(e.target.value),onBlur:e=>{var t;(null==(t=e.relatedTarget)?void 0:t.textContent)!=="削除"&&O()},onKeyDown:e=>{"Enter"===e.key&&e.ctrlKey?O():"Escape"===e.key&&(f(null),v(""))},className:"flex-1 text-gray-800 font-medium bg-transparent border-none outline-none resize-none min-h-[60px]",autoFocus:!0,rows:3}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),e.preventDefault(),console.log("Delete button clicked for index:",t),M(t)},onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},className:"text-red-500 hover:text-red-700 text-sm px-2 py-1 rounded hover:bg-red-50 transition-colors flex-shrink-0",type:"button",children:"削除"})]})}):(0,r.jsxs)("div",{className:"p-4 cursor-pointer flex items-start gap-3",onClick:e=>R(t,e),children:[(0,r.jsx)("div",{className:"drag-handle cursor-move p-2 hover:bg-gray-100 rounded transition-all duration-200 touch-manipulation active:bg-gray-200",title:"ドラッグして並び替え",children:(0,r.jsx)(U.A,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 transition-colors"})}),(0,r.jsxs)("span",{className:"text-teal-600 font-bold text-lg min-w-[24px] mt-1",children:[t+1,"."]}),(0,r.jsx)("div",{className:"flex-1 break-words",children:e.includes("ヒント：")?(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("div",{className:"text-gray-900 font-bold text-base leading-relaxed",children:e.split("ヒント：")[0].trim()}),(0,r.jsx)("div",{className:"border rounded-lg p-3 bg-gray-100 border-gray-300",children:(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-gray-500 font-medium text-xs flex-shrink-0",children:"\uD83D\uDCA1"}),(0,r.jsx)("span",{className:"text-xs leading-relaxed text-gray-900",children:null==(a=e.split("ヒント：")[1])?void 0:a.trim()})]})})]}):(0,r.jsx)("span",{className:"text-gray-900 font-bold text-base leading-relaxed",children:e})})]})}),(null==w?void 0:w.index)===t&&"after"===w.position&&(0,r.jsxs)("div",{className:"absolute -bottom-1 left-0 right-0 h-0.5 bg-teal-500 rounded-full z-10 animate-pulse",children:[(0,r.jsx)("div",{className:"absolute left-2 -top-1 w-2 h-2 bg-teal-500 rounded-full"}),(0,r.jsx)("div",{className:"absolute right-2 -top-1 w-2 h-2 bg-teal-500 rounded-full"})]})]},"".concat(t,"-").concat(e))})}),0===g.length&&(0,r.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,r.jsx)("p",{children:"タスクがありません"}),(0,r.jsx)("p",{className:"text-sm mt-1",children:"+ ボタンでタスクを追加しましょう"})]})]})}),(0,r.jsx)(u,{className:"fixed bottom-6 right-6 w-14 h-14 rounded-full shadow-lg bg-teal-600 hover:bg-teal-700 z-10 transition-all duration-200 hover:scale-110",size:"icon",onClick:()=>{let e="新しいタスク ".concat(g.length+1);h([...g,e])},children:(0,r.jsx)(l.A,{className:"w-6 h-6 text-white"})})]})}var et=a(7468);let ea={OPENAI_API_KEY:a(9509).env.OPENAI_API_KEY||""};async function er(e,t){try{var a,r,s;if(!ea.OPENAI_API_KEY)throw Error("OpenAI API key is not configured");console.log("\uD83D\uDD11 Using OpenAI API key:",ea.OPENAI_API_KEY.substring(0,20)+"...");let o=(0,et.r)({apiKey:ea.OPENAI_API_KEY}),l=(r=e,s=t,"【タスク情報】\n- タスクタイトル: ".concat(r,"\n- 詳細説明: ").concat(s,'\n\n【分解のルール】\n- ストーリーポイント1相当（30分〜2時間）になるまで細かく分けてください。\n- 各ステップは「目的」と「ヒント」を1つのタスクとして統合してください。\n- 曖昧な言葉は禁止（例：「調べる」→「Webで"〇〇とは"と検索する」）\n- 各ステップは**必ず具体的に手を動かせる内容**にしてください（「考える」や「検討する」はNG）\n- MECEは「作業工程全体が重複なく・漏れなくカバーされている」ことを意識してください。分類のMECEではありません。\n- 人間の思考力をサポートするように、Google など固有のサービスを固定せずに記載ください。\n- 人間の思考力がなくならないように、以下のストレスがかからない書き方にしてください。\n  - 思考の発散のタイミング、調査のタイミングで、Webや本などで調査するなど、やり方の指定の記載がある時、調査方法を具体的に指定せず、あくまで「ヒント」としていくつかの例を提示しつつ、ユーザーが自由に最適な方法を選択できる余地を残してください。\n\n【出力形式】\n- 各ステップは「目的」と「ヒント：」を含む1つのタスクとして出力する\n- 目的を最初に書き、改行してから「ヒント：」で具体的な方法を説明する\n- 上から順番に、誰でもそのまま実行できるように並べてください\n\n【入力例】\n> A4１枚でヤングケアラーについてのレポートを作成したいです。\n\n【出力例】\nヤングケアラーの基本的な意味を理解する\nヒント：検索エンジンで「ヤングケアラーとは」と検索し、簡単な説明を読む\n\nレポートの構成（見出し）を決める\nヒント：例として「定義」「現状」「課題」「支援策」など、A4一枚に収まる見出しを3～4個考える\n\n各見出しごとに使う情報をメモにまとめる\nヒント：検索結果や信頼できる記事から、短い文章やキーワードをコピーして貼り付ける\n\nレポートの文章を作成するための下書きを作る\nヒント：メモした情報を元に、簡単な文章を見出しごとに書き写す\n\n下書きをA4一枚のフォーマットにまとめる\nヒント：WordやGoogleドキュメントで用紙サイズA4に設定し、文章を整理して配置する\n\n誤字脱字や文法のミスをチェックする\nヒント：読み返して気になる部分を修正し、Webの文法チェックツールも使う\n\n完成したレポートをPDFに保存する\nヒント：ファイル→名前を付けて保存でPDF形式を選択し保存する\n\nそれでは、上記のタスクを分解してください。'));console.log("\uD83E\uDD16 Calling OpenAI API...");let n=null!=(a=(await o.chat("gpt-4o-mini").doGenerate({prompt:[{role:"user",content:[{type:"text",text:l}]}],inputFormat:"messages",mode:{type:"regular"},temperature:.7,maxTokens:1e3})).text)?a:"";if(!n)throw Error("AIからの応答が空でした。");console.log("✅ OpenAI API response received:",n.substring(0,100)+"...");let i=function(e){try{let t=e.split("\n").map(e=>e.trim()).filter(e=>e.length>0).filter(e=>!e.startsWith("#")).filter(e=>!e.startsWith("例：")).filter(e=>!e.includes("それでは")),a=[],r="";for(let e=0;e<t.length;e++){let s=t[e].replace(/^\d+\.\s*/,"").replace(/^[-*]\s*/,"").trim();s.startsWith("ヒント：")?r&&(r+="\n"+s,a.push(r),r=""):(r&&a.push(r),r=s)}if(r&&a.push(r),0===a.length)throw Error("No valid tasks found in response");return a.slice(0,100)}catch(e){return console.error("Failed to parse task breakdown response:",e),["タスクの詳細を整理する\nヒント：必要な情報や手順を紙やメモアプリに書き出してみる","必要な情報を収集する\nヒント：インターネット検索や関連資料から情報を集める","作業計画を立てる\nヒント：優先順位をつけて、どの順番で進めるかを決める","実際の作業を開始する\nヒント：最も簡単で取り組みやすいものから始める","進捗を確認して調整する\nヒント：定期的に進み具合をチェックし、必要に応じて計画を見直す","最終確認を行う\nヒント：完成したものを見直して、要件を満たしているか確認する"]}}(n);return console.log("\uD83D\uDCDD Parsed tasks:",i),{success:!0,tasks:i}}catch(t){console.error("❌ Task breakdown AI error:",t);let e="タスクの分解中にエラーが発生しました";return t instanceof Error&&(console.error("Error details:",{name:t.name,message:t.message,stack:t.stack}),e=t.message.includes("API key")||t.message.includes("missing")?"APIキーの設定に問題があります。設定を確認してください。":t.message.includes("network")||t.message.includes("fetch")?"ネットワークエラーが発生しました。インターネット接続を確認してください":t.message.includes("quota")||t.message.includes("limit")?"API利用制限に達しました。しばらく時間をおいてから再試行してください":t.message.includes("invalid")||t.message.includes("unauthorized")?"APIキーが無効です。正しいAPIキーを設定してください。":t.message.includes("insufficient_quota")?"APIの利用制限に達しました。OpenAIアカウントの残高を確認してください。":"エラー: ".concat(t.message)),{success:!1,tasks:[],error:e}}}function es(e){let{task:t,onBack:a,onTasksGenerated:o,onBackToHome:l,onTaskCompleted:n,tutorialStep:i,onTutorialStepComplete:c}=e,[d,m]=(0,s.useState)(""),[x,g]=(0,s.useState)(""),[h,p]=(0,s.useState)(!1),[f,b]=(0,s.useState)(!1),[v,k]=(0,s.useState)(null),[y,w]=(0,s.useState)(!0),[j,N]=(0,s.useState)([]),[S,D]=(0,s.useState)(!1),C=(0,s.useRef)(null),A=(0,s.useRef)(!1),T=(0,s.useRef)(0),E=(0,s.useRef)(null),[I,F]=(0,s.useState)(!1),[R,O]=(0,s.useState)(!1),L=(0,s.useRef)(0),[U,G]=(0,s.useState)(!1),J="task-breakdown-text-".concat(t.id);(0,s.useEffect)(()=>{"voice-input-demo"!==i||d.trim()||setTimeout(()=>{m("プレゼン資料を作成したいです。内容は新商品の紹介で、10分程度の発表を予定しています。スライドは10枚程度で、グラフや画像も含めたいと思います。来週の金曜日までに完成させる必要があります。")},1e3)},[i,c,d]),(0,s.useEffect)(()=>{"breakdown-submit"===i&&I&&setTimeout(()=>{c&&c("breakdown-submit")},1e3)},[I,i,c]),(0,s.useEffect)(()=>{try{let e=localStorage.getItem(J);e&&!i&&(m(e),console.log("Loaded saved text from localStorage:",e.length,"characters"))}catch(e){console.error("Failed to load saved text:",e)}},[J,i]),(0,s.useEffect)(()=>{if(d.trim()&&!i)try{localStorage.setItem(J,d),console.log("Saved text to localStorage:",d.length,"characters")}catch(e){console.error("Failed to save text:",e)}},[d,J,i]);let X=(0,s.useCallback)(e=>{if(!y)return e;let t=e;return[/\bえー\b/g,/\bあのー\b/g,/\bえっと\b/g,/\bうーん\b/g,/\bまあ\b/g,/\bそのー\b/g,/\bなんか\b/g,/\bっていうか\b/g,/\bほら\b/g].forEach(e=>{t=t.replace(e,"")}),t=t.replace(/\s+/g," ").trim()},[y]),q=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=E.current;if(!a)return void(t?g(e):(m(t=>t+e+" "),g("")));let r=L.current;t?g(e):(m(d.substring(0,r)+e+" "+d.substring(r)),g(""),setTimeout(()=>{let t=r+e.length+1;L.current=t,a.setSelectionRange(t,t),a.focus()},0))},[d]),V=(0,s.useCallback)(()=>{if(console.log("Cleaning up speech recognition..."),C.current){try{C.current.abort()}catch(e){console.log("Error during cleanup:",e)}C.current=null}p(!1),A.current=!1,g(""),G(!1)},[]),Q=(0,s.useCallback)(()=>{console.log("Creating new speech recognition instance...");let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e)return console.log("SpeechRecognition not available"),null;let t=new e;return t.continuous=!0,t.interimResults=!0,t.lang="ja-JP","maxAlternatives"in t&&(t.maxAlternatives=1),console.log("Speech recognition configured:",{continuous:t.continuous,interimResults:t.interimResults,lang:t.lang}),t.onstart=()=>{console.log("\uD83C\uDFA4 Speech recognition STARTED"),p(!0),A.current=!0,k(null),O(!1),G(!1),"breakdown-screen"===i&&c&&c("breakdown-screen")},t.onresult=e=>{console.log("\uD83D\uDD0A Speech recognition result received, results count:",e.results.length);let t="",a="";for(let r=0;r<e.results.length;r++){let s=e.results[r],o=s[0].transcript;console.log("\uD83D\uDCDD Result ".concat(r,": isFinal=").concat(s.isFinal,', transcript="').concat(o,'"')),s.isFinal?t+=o:a+=o}if(!R){if(a.trim()){let e=X(a);console.log("✏️ Inserting interim text:",e),q(e,!0)}if(t.trim()){let e=X(t);e.trim()&&(console.log("✅ Inserting final text:",e),q(e,!1))}}},t.onerror=e=>{switch(console.log("❌ Speech recognition error:",e.error,e.message),p(!1),A.current=!1,g(""),G(!1),e.error){case"not-allowed":k("マイクへのアクセスが拒否されました。ブラウザの設定を確認してください。");break;case"no-speech":console.log("No speech detected - this is normal, will restart automatically"),setTimeout(()=>{if(!A.current&&C.current)try{console.log("\uD83D\uDD04 Auto-restarting speech recognition after no-speech..."),C.current.start()}catch(e){console.log("Failed to auto-restart:",e)}},1e3);break;case"audio-capture":k("マイクが見つかりません。マイクが接続されているか確認してください。");break;case"network":k("ネットワークエラーです。インターネット接続を確認してください。");break;case"aborted":console.log("Speech recognition was aborted");break;default:console.error("Unknown speech recognition error:",e.error)}},t.onend=()=>{console.log("\uD83D\uDED1 Speech recognition ENDED"),p(!1),A.current=!1,g(""),G(!1),C.current=null},t},[X,q,R,i,c]);(0,s.useEffect)(()=>{let e=window.SpeechRecognition||window.webkitSpeechRecognition;return b(!!e),console.log("Speech recognition supported:",!!e),()=>{V()}},[V]);let Z=(0,s.useCallback)(async()=>{if(console.log("\uD83D\uDE80 Starting recording process..."),A.current||U)return void console.log("Already recording or initializing, skipping...");let e=Date.now();if(e-T.current<1e3)return void console.log("Preventing rapid clicking");T.current=e,G(!0),k(null);try{console.log("\uD83C\uDFA4 Requesting microphone permission...");let e=await navigator.mediaDevices.getUserMedia({audio:!0});console.log("✅ Microphone permission granted"),e.getTracks().forEach(e=>e.stop()),V(),console.log("\uD83D\uDD27 Creating new recognition instance...");let t=Q();if(!t)throw Error("Speech recognition not supported");C.current=t,E.current&&(L.current=E.current.selectionStart,console.log("\uD83D\uDCCD Cursor position recorded:",L.current)),console.log("▶️ Starting speech recognition..."),t.start()}catch(e){console.error("❌ Failed to start recording:",e),G(!1),e instanceof Error?"NotAllowedError"===e.name?k("マイクへのアクセスが拒否されました。ブラウザの設定を確認してください。"):"NotFoundError"===e.name?k("マイクが見つかりません。マイクが接続されているか確認してください。"):k("音声認識の開始に失敗しました。もう一度お試しください。"):k("音声認識の開始に失敗しました。もう一度お試しください。")}},[Q,V,U]),et=(0,s.useCallback)(()=>{if(console.log("⏹️ Stopping recording..."),!C.current||!A.current)return void console.log("Cannot stop recording: no recognition instance or not recording");try{console.log("\uD83D\uDED1 Calling recognition.stop()..."),C.current.stop()}catch(e){console.error("❌ Failed to stop recording:",e),V()}},[V]),ea=(0,s.useCallback)(()=>{console.log("\uD83D\uDD04 Toggle recording, current state:",{isRecording:A.current,isInitializing:U}),A.current?et():Z()},[Z,et,U]),es=e=>{if(!i)return!0;switch(i){case"breakdown-screen":case"voice-input":case"voice-input-demo":return"voice-input"===e||"text-input"===e;case"breakdown-submit":return"breakdown-submit"===e&&d.trim().length>0;default:return!1}},eo=async()=>{if(d.trim()){A.current&&et(),D(!0),k(null);try{let e=await er(t.title,d.trim());e.success&&e.tasks.length>0?(N(e.tasks),F(!0)):k(e.error||"タスクの分解に失敗しました。もう一度お試しください。")}catch(e){console.error("Task breakdown error:",e),k("タスクの分解中にエラーが発生しました。インターネット接続を確認してください。")}finally{D(!1)}}};if(I)return(0,r.jsx)(ee,{task:t,generatedTasks:j,onBack:()=>{F(!1)},onStart:()=>{a()},onTasksGenerated:o,onBackToHome:l,onTaskCompleted:n,tutorialStep:i,onTutorialStepComplete:c});let el=d+x;return(0,r.jsxs)("div",{className:"breakdown-container min-h-screen bg-gray-50 flex flex-col",children:[(0,r.jsx)($,{}),(0,r.jsxs)("div",{className:"bg-teal-600 px-4 py-3 flex items-center justify-between flex-shrink-0",children:[(0,r.jsx)(u,{variant:"ghost",size:"icon",onClick:a,className:"text-white hover:bg-teal-700",children:(0,r.jsx)("img",{src:"/images/back-arrow.png",alt:"戻る",className:"w-6 h-6 filter brightness-0 invert"})}),(0,r.jsx)(u,{variant:"outline",className:"breakdown-submit text-teal-600 border-white bg-white hover:bg-gray-100 disabled:opacity-50 ".concat(i&&!es("breakdown-submit")?"cursor-not-allowed":""),onClick:eo,disabled:!d.trim()||S||"breakdown-submit"===i&&!es("breakdown-submit"),children:S?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(_.A,{className:"w-4 h-4 mr-2 animate-spin"}),"分解中..."]}):"分解"})]}),(0,r.jsx)("div",{className:"flex-1 min-h-0 overflow-y-auto",children:(0,r.jsxs)("div",{className:"p-3 pb-40",children:[" ",(0,r.jsx)("h1",{className:"text-lg font-bold mb-3 text-slate-800",children:t.title}),v&&(0,r.jsxs)(Y,{variant:"destructive",className:"mb-3",children:[(0,r.jsx)(B.A,{className:"h-4 w-4"}),(0,r.jsxs)(W,{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-sm",children:v}),(0,r.jsx)(u,{variant:"ghost",size:"sm",onClick:()=>{k(null)},children:"\xd7"})]})]}),(0,r.jsx)(P,{className:"mb-3",children:(0,r.jsxs)(z,{className:"p-3",children:[(0,r.jsx)("p",{className:"text-sm text-gray-700 mb-2",children:"このタスクで「あなたがやること」と「目指すゴール」を教えてください"}),(0,r.jsxs)("div",{className:"bg-gray-100 p-2 rounded text-xs text-gray-600",children:["\uD83D\uDCAC ゴールが具体的なほど、タスクも細かく分けやすくなります！",(0,r.jsx)("br",{}),"\uD83C\uDFA4 音声入力またはテキスト入力どちらでもOKです"]})]})}),S&&(0,r.jsx)(P,{className:"mb-3",children:(0,r.jsx)(z,{className:"p-3",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(_.A,{className:"w-5 h-5 animate-spin text-teal-600"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-800",children:"AIがタスクを分解中..."}),(0,r.jsx)("p",{className:"text-xs text-gray-600",children:"分かりやすいステップに分けています"})]})]})})}),(0,r.jsx)(P,{className:"mb-3",children:(0,r.jsxs)(z,{className:"p-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("label",{htmlFor:"filler-toggle",className:"text-xs font-medium text-gray-700",children:"フィラー除去"}),(0,r.jsx)("button",{id:"filler-toggle",type:"button",className:"relative inline-flex h-5 w-9 items-center rounded-full transition-colors ".concat(y?"bg-teal-600":"bg-gray-200"),onClick:()=>w(!y),children:(0,r.jsx)("span",{className:"inline-block h-3 w-3 transform rounded-full bg-white transition-transform ".concat(y?"translate-x-5":"translate-x-1")})})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(u,{variant:"outline",size:"sm",onClick:()=>{m(""),g("");try{localStorage.removeItem(J),console.log("Cleared text from localStorage")}catch(e){console.error("Failed to clear text from localStorage:",e)}A.current&&et()},disabled:!d.trim()&&!x.trim(),className:"text-xs h-7 bg-transparent",children:"クリア"}),(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:[el.length,"文字"]})]})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(M,{ref:E,value:el,onChange:e=>{m(e.target.value),g(""),O(!0),setTimeout(()=>{E.current&&(L.current=E.current.selectionStart)},0)},onFocus:()=>{O(!0),E.current&&(L.current=E.current.selectionStart)},onBlur:()=>{setTimeout(()=>{O(!1)},500)},placeholder:"ここにテキストを入力するか、下のマイクボタンで音声入力してください...",className:"tutorial-text-input min-h-[200px] resize-none text-sm ".concat(i&&!es("text-input")?"opacity-50 cursor-not-allowed":""),disabled:!!(i&&!es("text-input"))}),x&&(0,r.jsx)("div",{className:"absolute bottom-2 right-2 bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs",children:"認識中..."})]}),y&&(0,r.jsx)("div",{className:"bg-blue-50 p-2 rounded text-xs text-blue-700 mt-2",children:"\uD83D\uDCA1 フィラー除去が有効です。「えー」「あー」「うーん」などの不要な言葉は自動的に除去されます。"}),d&&!i&&(0,r.jsx)("div",{className:"bg-green-50 p-2 rounded text-xs text-green-700 mt-2",children:"\uD83D\uDCBE 入力内容は自動的に保存されています"}),!f&&(0,r.jsxs)(Y,{className:"mt-2",children:[(0,r.jsx)(B.A,{className:"h-4 w-4"}),(0,r.jsxs)(W,{className:"text-xs",children:["お使いのブラウザは音声認識に対応していません。Chrome、Safari、Edgeをお試しください。",(0,r.jsx)("br",{}),"テキスト入力は引き続きご利用いただけます。"]})]})]})})]})}),(0,r.jsx)("div",{className:"fixed bottom-6 left-1/2 transform -translate-x-1/2 z-10",children:(0,r.jsx)(u,{size:"lg",className:"voice-input-button w-14 h-14 rounded-full transition-all duration-200 ".concat(h?"bg-red-500 hover:bg-red-600 animate-pulse shadow-lg":U?"bg-yellow-500 hover:bg-yellow-600 shadow-lg":f?"bg-teal-600 hover:bg-teal-700 shadow-md":"bg-gray-400 cursor-not-allowed shadow-md"," ").concat(i&&!es("voice-input")?"opacity-50 cursor-not-allowed":""),onClick:ea,disabled:!f||S||!!(i&&!es("voice-input")),children:U?(0,r.jsx)(_.A,{className:"h-7 w-7 text-white animate-spin"}):h?(0,r.jsx)(H.A,{className:"h-7 w-7 text-white"}):(0,r.jsx)(K.A,{className:"text-white w-[55px] h-[55px]"})})}),h&&(0,r.jsx)("div",{className:"fixed bottom-24 left-1/2 transform -translate-x-1/2 z-10",children:(0,r.jsx)("div",{className:"bg-red-500 text-white px-3 py-1 rounded-full text-xs animate-pulse",children:"\uD83C\uDFA4 リアルタイム認識中"})}),U&&!h&&(0,r.jsx)("div",{className:"fixed bottom-24 left-1/2 transform -translate-x-1/2 z-10",children:(0,r.jsx)("div",{className:"bg-yellow-500 text-white px-3 py-1 rounded-full text-xs",children:"\uD83D\uDD04 音声認識を準備中..."})})]})}var eo=a(6766);function el(){let[e,t]=(0,s.useState)("immediate"),[n,i]=(0,s.useState)([]),[c,d]=(0,s.useState)(!1),[m,x]=(0,s.useState)(!1),[g,h]=(0,s.useState)(null),[p,f]=(0,s.useState)(!1),[b,v]=(0,s.useState)("welcome"),y=(0,s.useRef)(null),[w,j]=(0,s.useState)(null),[D,C]=(0,s.useState)(null);(0,s.useEffect)(()=>{let e=localStorage.getItem(N.STORAGE_KEYS.TUTORIAL_COMPLETED);console.log("Tutorial completion status:",e),e?console.log("Returning user - tutorial already completed"):(console.log("First time user - showing tutorial"),f(!0))},[]),(0,s.useEffect)(()=>{if(p&&"welcome"===b){let e={id:"tutorial-sample-task",title:"授業アンケートを提出する",completed:!1,category:"immediate",createdAt:new Date};i(t=>t.some(e=>"tutorial-sample-task"===e.id)?t:[e,...t])}},[p,b]),(0,s.useEffect)(()=>{try{(0,N.checkStorageHealth)(),(0,N.performPeriodicCleanup)();let e=localStorage.getItem(N.STORAGE_KEYS.TASKS);if(e){let t=JSON.parse(e).map(e=>({...e,dueDate:e.dueDate?new Date(e.dueDate):void 0,createdAt:new Date(e.createdAt)}));i(t),console.log("\uD83D\uDCCB Loaded ".concat(t.length," tasks from localStorage"))}}catch(e){console.error("❌ Failed to load tasks from localStorage:",e),i([])}},[]),(0,s.useEffect)(()=>{if(!p)try{let e=n.filter(e=>"tutorial-sample-task"!==e.id);localStorage.setItem(N.STORAGE_KEYS.TASKS,JSON.stringify(e)),console.log("\uD83D\uDCBE Saved ".concat(e.length," tasks to localStorage")),(0,N.checkStorageHealth)()}catch(e){if(console.error("❌ Failed to save tasks to localStorage:",e),e instanceof Error&&"QuotaExceededError"===e.name){console.log("\uD83D\uDEA8 Storage quota exceeded, performing cleanup...");let{emergencyCleanup:e}=a(3987);e();try{let e=n.filter(e=>"tutorial-sample-task"!==e.id);localStorage.setItem(N.STORAGE_KEYS.TASKS,JSON.stringify(e)),console.log("✅ Successfully saved after cleanup")}catch(e){console.error("❌ Failed to save even after cleanup:",e)}}}},[n,p]),(0,s.useEffect)(()=>{y.current&&(y.current.scrollTop=0)},[e]),(0,s.useEffect)(()=>{p&&"tabs-explanation"===b&&"later"===e&&setTimeout(()=>T("tabs-explanation"),500),p&&"tab-switch-back"===b&&"immediate"===e&&setTimeout(()=>T("tab-switch-back"),500)},[e,b,p]);let T=e=>{console.log("Main page: Tutorial step completed:",e);let t=["welcome","tabs-explanation","tab-switch","tab-switch-back","simple-task-explanation","simple-task-completion","undo-explanation","add-task-button","task-form-explanation","task-breakdown","breakdown-screen","voice-input","voice-input-demo","breakdown-submit","breakdown-results","start-execution","execution-overview","current-task-explanation","complete-first-task","interrupt-explanation","tutorial-skip-notice","complete"],a=t.indexOf(e);if(console.log("Main page: Current step index:",a),a<t.length-1){let e=t[a+1];console.log("Main page: Moving to next step:",e),v(e)}else H()};(0,s.useEffect)(()=>{p&&"add-task-button"===b&&c&&setTimeout(()=>T("add-task-button"),500)},[c,b,p]),(0,s.useEffect)(()=>{p&&"task-form-explanation"===b&&n.filter(e=>"tutorial-sample-task"!==e.id).length>0&&setTimeout(()=>T("task-form-explanation"),1e3)},[n,b,p]),(0,s.useEffect)(()=>{p&&"simple-task-completion"===b&&(null==g?void 0:g.id)==="tutorial-sample-task"&&setTimeout(()=>T("simple-task-completion"),1e3)},[g,b,p]),(0,s.useEffect)(()=>{p&&"task-breakdown"===b&&w&&setTimeout(()=>T("task-breakdown"),500)},[w,b,p]),(0,s.useEffect)(()=>{p&&"start-execution"===b&&D&&setTimeout(()=>T("start-execution"),500)},[D,b,p]);let F=e=>{let t=n.find(t=>t.id===e);if(t)if(t.completed)i(t=>t.map(t=>t.id===e?{...t,completed:!1}:t)),(null==g?void 0:g.id)===e&&g.autoDeleteTimer&&(clearTimeout(g.autoDeleteTimer),h(null));else{i(t=>t.map(t=>t.id===e?{...t,completed:!0}:t));let a={...t,completed:!0,completedAt:new Date};a.autoDeleteTimer=setTimeout(()=>{i(t=>t.filter(t=>t.id!==e)),"tutorial-sample-task"!==e&&(0,N.addToTrash)({id:t.id,title:t.title,deletedAt:new Date,category:t.category}),"tutorial-sample-task"!==e&&(0,N.cleanupCompletedTask)(e),h(null),console.log("\uD83D\uDDD1️ Auto-deleted completed task: ".concat(t.title))},5e3),h(a),p&&"complete-first-task"===b&&setTimeout(()=>T("complete-first-task"),1e3)}},R=(e,t,a)=>{i(r=>r.map(r=>r.id===e?{...r,title:t,dueDate:a}:r))},M=e=>{let t=n.find(t=>t.id===e);t&&(i(t=>t.filter(t=>t.id!==e)),"tutorial-sample-task"!==e&&(0,N.addToTrash)({id:t.id,title:t.title,deletedAt:new Date,category:t.category}),"tutorial-sample-task"!==e&&(0,N.cleanupCompletedTask)(e),console.log("\uD83D\uDDD1️ Manually deleted task: ".concat(t.title)))},P=e=>{let t=n.find(t=>t.id===e);t&&j(t)},z=e=>{let t=n.find(t=>t.id===e);if(t){let e=S(t.id);e&&e.generatedTasks.length>0?(C({...t,generatedTasks:e.generatedTasks}),console.log("Opening execution with saved progress:",e)):t.isBreakdown&&t.generatedTasks?(C(t),console.log("Opening execution with task generatedTasks:",t.generatedTasks)):console.error("No generated tasks found for breakdown task:",t)}},_=()=>{j(null),C(null),t("immediate")},B=e=>{i(t=>t.filter(t=>t.id!==e)),(0,N.cleanupCompletedTask)(e),_(),console.log("\uD83C\uDF89 Completed and cleaned up task: ".concat(e))},H=()=>{try{localStorage.setItem(N.STORAGE_KEYS.TUTORIAL_COMPLETED,"true"),f(!1),i(e=>e.filter(e=>"tutorial-sample-task"!==e.id)),console.log("✅ Tutorial completed and saved")}catch(e){console.error("❌ Failed to save tutorial completion:",e),f(!1)}},K=(e,t)=>{if(!p)return!0;switch(b){case"welcome":case"tab-switch":case"simple-task-explanation":case"execution-overview":case"current-task-explanation":case"tutorial-skip-notice":case"complete":default:return!1;case"tabs-explanation":return"tab-later"===e;case"tab-switch-back":return"tab-immediate"===e;case"simple-task-completion":return"task-check"===e&&"tutorial-sample-task"===t;case"undo-explanation":return"undo-button"===e;case"add-task-button":return"add-task"===e;case"task-form-explanation":return"task-form-submit"===e;case"task-breakdown":return"task-breakdown"===e&&"tutorial-sample-task"!==t;case"breakdown-screen":case"voice-input":case"voice-input-demo":case"breakdown-submit":return"breakdown-submit"===e||"voice-input"===e||"text-input"===e;case"breakdown-results":return"start-execution"===e||"task-edit"===e||"task-reorder"===e;case"start-execution":return"start-execution"===e;case"complete-first-task":return"current-task-check"===e;case"interrupt-explanation":return"interrupt-button"===e}},L=[...n.filter(t=>t.category===e)].sort((e,t)=>e.dueDate||t.dueDate?e.dueDate?t.dueDate?e.dueDate.getTime()-t.dueDate.getTime():-1:1:0),Y="immediate"===e?"text-red-500":"text-blue-500";return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col japanese-text",children:[(0,r.jsx)($,{}),(0,r.jsxs)("div",{className:"bg-white px-4 text-center flex-shrink-0 py-6 border-b",children:[(0,r.jsxs)("div",{className:"flex items-center relative justify-center mb-[-15px]",children:[(0,r.jsx)(eo.default,{src:"/images/yarn-ball-logo.png",alt:"とっかかりプランナー ロゴ",width:64,height:64,className:"w-16 h-16"}),(0,r.jsx)(u,{variant:"ghost",size:"icon",onClick:()=>x(!0),className:"absolute right-0 top-0 text-gray-400 hover:text-gray-600 hover:bg-gray-100",disabled:p,children:(0,r.jsx)(o.A,{className:"w-5 h-5"})})]}),(0,r.jsx)("h1",{className:"font-bold app-title font-mono text-lg text-gray-900",children:"tokkakari"}),(0,r.jsx)("button",{onClick:()=>f(!0),className:"mt-2 text-xs text-gray-500 hover:text-gray-700 transition-colors font-bold",children:"チュートリアルを見る"})]}),(0,r.jsx)("div",{className:"tabs-container bg-white flex-shrink-0",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("button",{onClick:()=>t("immediate"),disabled:!K("tab-immediate"),className:"tab-immediate flex-1 py-4 px-4 text-center font-bold tab-text border-b-2 transition-colors ".concat("immediate"===e?"border-b-2":"text-gray-600 border-transparent"," ").concat(K("tab-immediate")?"":"opacity-50 cursor-not-allowed"),style:{color:"immediate"===e?"#FF5F68":"#444444",borderBottomColor:"immediate"===e?"#FF5F68":"transparent"},children:"まず最初にやる事"}),(0,r.jsx)("button",{onClick:()=>t("later"),disabled:!K("tab-later"),className:"tab-later flex-1 py-4 px-4 text-center font-bold tab-text border-b-2 transition-colors ".concat("later"===e?"border-b-2":"text-gray-600 border-transparent"," ").concat(K("tab-later")?"":"opacity-50 cursor-not-allowed"),style:{color:"later"===e?"#007AFF":"#444444",borderBottomColor:"later"===e?"#007AFF":"transparent"},children:"後でじっくり考える事"})]})}),(0,r.jsx)("div",{ref:y,className:"flex-1 overflow-y-auto",children:(0,r.jsxs)("div",{className:"p-4 pb-32",children:[(0,r.jsx)("h2",{className:"text-lg font-bold mb-6",style:{color:"immediate"===e?"#FF5F68":"#007AFF"},children:"immediate"===e?"まず最初にやること":"後でじっくり考えること"}),(0,r.jsxs)("div",{className:"space-y-3",children:[L.map(e=>(0,r.jsx)(A,{task:e,onToggleComplete:F,onEdit:R,onDelete:M,onBreakdown:P,onExecute:z,accentColor:Y,tutorialStep:p?b:null,showTutorial:p},e.id)),0===L.length&&(0,r.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,r.jsx)("p",{className:"font-bold",children:"タスクがありません"}),(0,r.jsx)("p",{className:"text-sm mt-1 font-bold",children:"+ ボタンでタスクを追加しましょう"})]})]})]})}),(0,r.jsx)(u,{className:"add-task-button fixed bottom-6 right-6 w-14 h-14 rounded-full shadow-lg z-10 font-bold ".concat(K("add-task")?"":"opacity-50 cursor-not-allowed"),style:{backgroundColor:"immediate"===e?"#FF5F68":"#007AFF",color:"#FFFFFF"},size:"icon",onClick:()=>d(!0),disabled:!K("add-task"),children:(0,r.jsx)(l.A,{className:"w-6 h-6"})}),(0,r.jsx)(k,{isOpen:c,onClose:()=>d(!1),onSubmit:(t,a,r)=>{let s={id:Date.now().toString(),title:t,completed:!1,dueDate:a,category:r||e,createdAt:new Date};i(e=>[...e,s])},category:e,tutorialStep:p?b:null,onTutorialStepComplete:T}),(0,r.jsx)(I,{isOpen:m,onClose:()=>x(!1)}),(0,r.jsx)(E,{isVisible:!!g,taskTitle:(null==g?void 0:g.title)||"",onUndo:()=>{(null==g?void 0:g.autoDeleteTimer)&&(clearTimeout(g.autoDeleteTimer),i(e=>e.map(e=>e.id===g.id?{...e,completed:!1}:e)),h(null),console.log("↩️ Undid deletion for task: ".concat(g.title)))},onClose:()=>{h(null)}}),(0,r.jsx)(O,{isActive:p,currentStep:b,onComplete:H,onSkip:()=>{f(!1),i(e=>e.filter(e=>"tutorial-sample-task"!==e.id))},onStepComplete:T}),w&&(0,r.jsx)("div",{className:"fixed inset-0 bg-white z-50",children:(0,r.jsx)(es,{task:w,onBack:()=>j(null),onTasksGenerated:function(t){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t.map(t=>({id:Date.now().toString()+Math.random(),title:t,completed:!1,category:(null==w?void 0:w.category)||e,createdAt:new Date}));i(e=>[...e,...r]),a&&w&&i(e=>e.map(e=>e.id===w.id?{...e,isBreakdown:!0,generatedTasks:t}:e))},onBackToHome:_,onTaskCompleted:B,tutorialStep:p?b:null,onTutorialStepComplete:T})}),D&&(0,r.jsx)("div",{className:"fixed inset-0 bg-white z-50",children:(0,r.jsx)(Z,{task:D,generatedTasks:D.generatedTasks||[],onBack:()=>C(null),onBackToHome:_,onTaskCompleted:B,tutorialStep:p?b:null,onTutorialStepComplete:T,onAddTask:t=>{let a={id:Date.now().toString()+Math.random(),title:t,completed:!1,category:(null==D?void 0:D.category)||e,createdAt:new Date};i(e=>[...e,a])}})})]})}},3987:(e,t,a)=>{"use strict";a.r(t),a.d(t,{STORAGE_KEYS:()=>r,addToTrash:()=>s,checkStorageHealth:()=>m,cleanupCompletedTask:()=>i,cleanupOldTrashItems:()=>n,createBackup:()=>x,emergencyCleanup:()=>u,emptyTrash:()=>l,getStorageUsage:()=>d,getTrashItems:()=>o,performPeriodicCleanup:()=>c,restoreFromBackup:()=>g});let r={TASKS:"tokkakari-tasks",TASK_PROGRESS_PREFIX:"task-progress-",TASK_BREAKDOWN_TEXT_PREFIX:"task-breakdown-text-",LAST_CLEANUP:"tokkakari-last-cleanup",TUTORIAL_COMPLETED:"tokkakari-tutorial-completed",TRASH:"tokkakari-trash"};function s(e){try{console.log("\uD83D\uDDD1️ Adding to trash: ".concat(e.title));let t=o(),a=[e,...t].slice(0,50);localStorage.setItem(r.TRASH,JSON.stringify(a)),console.log("✅ Added to trash successfully. Total items: ".concat(a.length))}catch(e){console.error("❌ Failed to add to trash:",e)}}function o(){try{let e=localStorage.getItem(r.TRASH);if(!e)return[];return JSON.parse(e).map(e=>({...e,deletedAt:new Date(e.deletedAt)}))}catch(e){return console.error("❌ Failed to get trash items:",e),[]}}function l(){try{localStorage.removeItem(r.TRASH),console.log("\uD83D\uDDD1️ Trash emptied successfully")}catch(e){console.error("❌ Failed to empty trash:",e)}}function n(){try{let e=o(),t=new Date(Date.now()-2592e6),a=e.filter(e=>e.deletedAt>t);a.length!==e.length&&(localStorage.setItem(r.TRASH,JSON.stringify(a)),console.log("\uD83E\uDDF9 Cleaned up ".concat(e.length-a.length," old trash items")))}catch(e){console.error("❌ Failed to cleanup old trash items:",e)}}function i(e){try{console.log("\uD83D\uDDD1️ Cleaning up completed task: ".concat(e));let t="".concat(r.TASK_PROGRESS_PREFIX).concat(e);localStorage.removeItem(t),console.log("Removed progress data: ".concat(t));let a="".concat(r.TASK_BREAKDOWN_TEXT_PREFIX).concat(e);localStorage.removeItem(a),console.log("Removed breakdown text: ".concat(a)),console.log("✅ Successfully cleaned up task: ".concat(e))}catch(t){console.error("❌ Failed to cleanup task ".concat(e,":"),t)}}function c(){try{let e=Date.now(),t=localStorage.getItem(r.LAST_CLEANUP),a=t?Number.parseInt(t):0;if(e-a>864e5){console.log("\uD83E\uDDF9 Performing periodic cleanup..."),n();let t=localStorage.getItem(r.TASKS),a=t?JSON.parse(t):[],s=new Set(a.map(e=>e.id)),o=[];for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(t){if(t.startsWith(r.TASK_PROGRESS_PREFIX)){let e=t.replace(r.TASK_PROGRESS_PREFIX,"");s.has(e)||o.push(t)}if(t.startsWith(r.TASK_BREAKDOWN_TEXT_PREFIX)){let e=t.replace(r.TASK_BREAKDOWN_TEXT_PREFIX,"");s.has(e)||o.push(t)}}}o.forEach(e=>{localStorage.removeItem(e),console.log("Removed orphaned data: ".concat(e))}),localStorage.setItem(r.LAST_CLEANUP,e.toString()),console.log("✅ Periodic cleanup completed. Removed ".concat(o.length," orphaned entries."))}}catch(e){console.error("❌ Failed to perform periodic cleanup:",e)}}function d(){try{let e=0;for(let t=0;t<localStorage.length;t++){let a=localStorage.key(t);if(a){let t=localStorage.getItem(a);t&&(e+=a.length+t.length)}}let t=Math.round(e/5242880*100);return{used:e,total:5242880,percentage:t}}catch(e){return console.error("Failed to calculate storage usage:",e),{used:0,total:0,percentage:0}}}function u(){try{console.log("\uD83D\uDEA8 Performing emergency cleanup..."),l();let e=Date.now()-6048e5,t=[];for(let a=0;a<localStorage.length;a++){let s=localStorage.key(a);if(s){if(s.startsWith(r.TASK_PROGRESS_PREFIX))try{let a=localStorage.getItem(s);if(a){let r=JSON.parse(a);r.timestamp&&r.timestamp<e&&t.push(s)}}catch(e){t.push(s)}s.startsWith(r.TASK_BREAKDOWN_TEXT_PREFIX)&&t.push(s)}}t.forEach(e=>{localStorage.removeItem(e)}),console.log("\uD83D\uDDD1️ Emergency cleanup completed. Removed ".concat(t.length," old entries."))}catch(e){console.error("❌ Emergency cleanup failed:",e)}}function m(){try{let e=d();if(console.log("\uD83D\uDCCA Storage usage: ".concat(e.percentage,"% (").concat(Math.round(e.used/1024),"KB / ").concat(Math.round(e.total/1024),"KB)")),e.percentage>80)return console.warn("⚠️ Storage usage is high, consider cleanup"),u(),!1;return!0}catch(e){return console.error("Failed to check storage health:",e),!1}}function x(){try{let e={timestamp:Date.now(),tasks:localStorage.getItem(r.TASKS),tutorialCompleted:localStorage.getItem(r.TUTORIAL_COMPLETED),trash:localStorage.getItem(r.TRASH)};return JSON.stringify(e)}catch(e){return console.error("Failed to create backup:",e),null}}function g(e){try{let t=JSON.parse(e);return t.tasks&&localStorage.setItem(r.TASKS,t.tasks),t.tutorialCompleted&&localStorage.setItem(r.TUTORIAL_COMPLETED,t.tutorialCompleted),t.trash&&localStorage.setItem(r.TRASH,t.trash),console.log("✅ Successfully restored from backup"),!0}catch(e){return console.error("❌ Failed to restore from backup:",e),!1}}},3999:(e,t,a)=>{"use strict";a.d(t,{cn:()=>o});var r=a(2596),s=a(9688);function o(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,r.$)(t))}},6300:(e,t,a)=>{Promise.resolve().then(a.bind(a,3022))}},e=>{var t=t=>e(e.s=t);e.O(0,[937,342,441,684,358],()=>t(6300)),_N_E=e.O()}]);